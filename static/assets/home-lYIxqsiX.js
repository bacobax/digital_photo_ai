import{v as Be,x as ve,p as x,a as Q,w as nt}from"./chunk-NISHYRIK-DhSKFKgW.js";var Te={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var He;function at(){return He||(He=1,(function(w){(function(){var N={}.hasOwnProperty;function o(){for(var s="",a=0;a<arguments.length;a++){var n=arguments[a];n&&(s=f(s,y(n)))}return s}function y(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return o.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var a="";for(var n in s)N.call(s,n)&&s[n]&&(a=f(a,n));return a}function f(s,a){return a?s?s+" "+a:s+a:s}w.exports?(o.default=o,w.exports=o):window.classNames=o})()})(Te)),Te.exports}var it=at();const fe=Be(it);var Ee={exports:{}},st=Ee.exports,Ze;function ot(){return Ze||(Ze=1,(function(w,N){(function(o,y){y()})(st,function(){function o(h,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function y(h,u,g){var _=new XMLHttpRequest;_.open("GET",h),_.responseType="blob",_.onload=function(){d(_.response,u,g)},_.onerror=function(){console.error("could not download file")},_.send()}function f(h){var u=new XMLHttpRequest;u.open("HEAD",h,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function s(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(u)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ve=="object"&&ve.global===ve?ve:void 0,n=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!n?function(h,u,g){var _=a.URL||a.webkitURL,i=document.createElement("a");u=u||h.name||"download",i.download=u,i.rel="noopener",typeof h=="string"?(i.href=h,i.origin===location.origin?s(i):f(i.href)?y(h,u,g):s(i,i.target="_blank")):(i.href=_.createObjectURL(h),setTimeout(function(){_.revokeObjectURL(i.href)},4e4),setTimeout(function(){s(i)},0))}:"msSaveOrOpenBlob"in navigator?function(h,u,g){if(u=u||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(o(h,g),u);else if(f(h))y(h,u,g);else{var _=document.createElement("a");_.href=h,_.target="_blank",setTimeout(function(){s(_)})}}:function(h,u,g,_){if(_=_||open("","_blank"),_&&(_.document.title=_.document.body.innerText="downloading..."),typeof h=="string")return y(h,u,g);var i=h.type==="application/octet-stream",p=/constructor/i.test(a.HTMLElement)||a.safari,t=/CriOS\/[\d]+/.test(navigator.userAgent);if((t||i&&p||n)&&typeof FileReader<"u"){var l=new FileReader;l.onloadend=function(){var S=l.result;S=t?S:S.replace(/^data:[^;]*;/,"data:attachment/file;"),_?_.location.href=S:location=S,_=null},l.readAsDataURL(h)}else{var c=a.URL||a.webkitURL,b=c.createObjectURL(h);_?_.location=b:location.href=b,_=null,setTimeout(function(){c.revokeObjectURL(b)},4e4)}});a.saveAs=d.saveAs=d,w.exports=d})})(Ee)),Ee.exports}var lt=ot();const We=Be(lt),$e="/process",dt="http://127.0.0.1:8000/process",ct=12*1024*1024,ut=["image/jpeg","image/png","image/heic","image/heif","image/webp"],ye=["queued","processing","balancing","detecting","cropping","annotating","done"],ht={primary:"bg-sky-100 text-sky-900 dark:bg-sky-950 dark:text-sky-100 border border-sky-200 dark:border-sky-800",info:"bg-teal-100 text-teal-900 dark:bg-teal-950 dark:text-teal-100 border border-teal-200 dark:border-teal-800",warning:"bg-amber-100 text-amber-900 dark:bg-amber-950 dark:text-amber-100 border border-amber-200 dark:border-amber-800",success:"bg-emerald-100 text-emerald-900 dark:bg-emerald-950 dark:text-emerald-100 border border-emerald-200 dark:border-emerald-800",neutral:"bg-slate-100 text-slate-900 dark:bg-slate-800 dark:text-slate-100 border border-slate-200 dark:border-slate-700"},Qe=[{code:"en",label:"EN",nativeName:"English"},{code:"it",label:"IT",nativeName:"Italiano"},{code:"es",label:"ES",nativeName:"Espanol"}],Ge=/final_balanced/i,Ke=/final_annotated/i,ft=/(face\d+)/i;function pt({messages:w,language:N,onLanguageChange:o,highContrast:y,onToggleContrast:f}){return x.jsxs("header",{className:"flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between",children:[x.jsxs("div",{className:"space-y-2",children:[x.jsx("h1",{className:"text-3xl font-semibold tracking-tight sm:text-4xl",children:w.appTitle}),x.jsx("p",{className:"max-w-2xl text-base text-slate-600 dark:text-slate-300",children:w.appSubtitle})]}),x.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[x.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-200",children:[x.jsx("span",{className:"sr-only",children:w.languageLabel}),x.jsx("select",{"aria-label":w.languageSwitchAria,className:"rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-4 focus:ring-sky-200 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:focus:border-sky-400 dark:focus:ring-sky-950",value:N,onChange:s=>o(s.target.value),children:Qe.map(({code:s,label:a,nativeName:n})=>x.jsxs("option",{value:s,children:[a," Â· ",n]},s))})]}),x.jsxs("button",{type:"button",role:"switch","aria-checked":y,onClick:f,className:fe("inline-flex items-center gap-2 rounded-md px-3 py-2 text-sm font-medium transition-colors focus:outline-none focus:ring-4 focus:ring-sky-200 dark:focus:ring-sky-900",y?"bg-slate-900 text-white dark:bg-white dark:text-slate-900":"bg-slate-200 text-slate-900 dark:bg-slate-800 dark:text-slate-100"),children:[x.jsx("span",{children:w.contrastToggleLabel}),x.jsx("span",{className:"rounded bg-white/70 px-2 py-0.5 text-xs font-semibold text-slate-900 dark:bg-slate-900/60 dark:text-slate-100",children:y?w.contrastToggleOn:w.contrastToggleOff})]})]})]})}function mt({toast:w,onDismiss:N,closeLabel:o}){return w?x.jsx("div",{role:"status","aria-live":"polite",className:fe("fixed inset-x-0 top-3 z-20 mx-auto w-[calc(100%-2rem)] max-w-xl rounded-lg border px-4 py-3 shadow-lg sm:px-5",w.type==="success"?"border-emerald-200 bg-emerald-50 text-emerald-900 dark:border-emerald-800 dark:bg-emerald-950 dark:text-emerald-100":"border-rose-200 bg-rose-50 text-rose-900 dark:border-rose-800 dark:bg-rose-950 dark:text-rose-100"),children:x.jsxs("div",{className:"flex items-start gap-3",children:[x.jsx("span",{className:"mt-0.5 inline-block h-2 w-2 rounded-full bg-current","aria-hidden":"true"}),x.jsx("p",{className:"flex-1 text-sm font-medium",children:w.message}),x.jsx("button",{type:"button",onClick:N,className:"rounded-md px-2 py-1 text-xs font-semibold text-slate-600 transition-colors hover:bg-white/40 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-sky-400 dark:text-slate-200 dark:hover:bg-slate-800/70 dark:hover:text-white",children:o})]})}):null}function Ne(w){throw new Error('Could not dynamically require "'+w+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ie={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var qe;function gt(){return qe||(qe=1,(function(w,N){(function(o){w.exports=o()})(function(){return(function o(y,f,s){function a(h,u){if(!f[h]){if(!y[h]){var g=typeof Ne=="function"&&Ne;if(!u&&g)return g(h,!0);if(n)return n(h,!0);var _=new Error("Cannot find module '"+h+"'");throw _.code="MODULE_NOT_FOUND",_}var i=f[h]={exports:{}};y[h][0].call(i.exports,function(p){var t=y[h][1][p];return a(t||p)},i,i.exports,o,y,f,s)}return f[h].exports}for(var n=typeof Ne=="function"&&Ne,d=0;d<s.length;d++)a(s[d]);return a})({1:[function(o,y,f){var s=o("./utils"),a=o("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";f.encode=function(d){for(var h,u,g,_,i,p,t,l=[],c=0,b=d.length,S=b,A=s.getTypeOf(d)!=="string";c<d.length;)S=b-c,g=A?(h=d[c++],u=c<b?d[c++]:0,c<b?d[c++]:0):(h=d.charCodeAt(c++),u=c<b?d.charCodeAt(c++):0,c<b?d.charCodeAt(c++):0),_=h>>2,i=(3&h)<<4|u>>4,p=1<S?(15&u)<<2|g>>6:64,t=2<S?63&g:64,l.push(n.charAt(_)+n.charAt(i)+n.charAt(p)+n.charAt(t));return l.join("")},f.decode=function(d){var h,u,g,_,i,p,t=0,l=0,c="data:";if(d.substr(0,c.length)===c)throw new Error("Invalid base64 input, it looks like a data url.");var b,S=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===n.charAt(64)&&S--,d.charAt(d.length-2)===n.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=a.uint8array?new Uint8Array(0|S):new Array(0|S);t<d.length;)h=n.indexOf(d.charAt(t++))<<2|(_=n.indexOf(d.charAt(t++)))>>4,u=(15&_)<<4|(i=n.indexOf(d.charAt(t++)))>>2,g=(3&i)<<6|(p=n.indexOf(d.charAt(t++))),b[l++]=h,i!==64&&(b[l++]=u),p!==64&&(b[l++]=g);return b}},{"./support":30,"./utils":32}],2:[function(o,y,f){var s=o("./external"),a=o("./stream/DataWorker"),n=o("./stream/Crc32Probe"),d=o("./stream/DataLengthProbe");function h(u,g,_,i,p){this.compressedSize=u,this.uncompressedSize=g,this.crc32=_,this.compression=i,this.compressedContent=p}h.prototype={getContentWorker:function(){var u=new a(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),g=this;return u.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new a(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(u,g,_){return u.pipe(new n).pipe(new d("uncompressedSize")).pipe(g.compressWorker(_)).pipe(new d("compressedSize")).withStreamInfo("compression",g)},y.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(o,y,f){var s=o("./stream/GenericWorker");f.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},f.DEFLATE=o("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(o,y,f){var s=o("./utils"),a=(function(){for(var n,d=[],h=0;h<256;h++){n=h;for(var u=0;u<8;u++)n=1&n?3988292384^n>>>1:n>>>1;d[h]=n}return d})();y.exports=function(n,d){return n!==void 0&&n.length?s.getTypeOf(n)!=="string"?(function(h,u,g,_){var i=a,p=_+g;h^=-1;for(var t=_;t<p;t++)h=h>>>8^i[255&(h^u[t])];return-1^h})(0|d,n,n.length,0):(function(h,u,g,_){var i=a,p=_+g;h^=-1;for(var t=_;t<p;t++)h=h>>>8^i[255&(h^u.charCodeAt(t))];return-1^h})(0|d,n,n.length,0):0}},{"./utils":32}],5:[function(o,y,f){f.base64=!1,f.binary=!1,f.dir=!1,f.createFolders=!0,f.date=null,f.compression=null,f.compressionOptions=null,f.comment=null,f.unixPermissions=null,f.dosPermissions=null},{}],6:[function(o,y,f){var s=null;s=typeof Promise<"u"?Promise:o("lie"),y.exports={Promise:s}},{lie:37}],7:[function(o,y,f){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=o("pako"),n=o("./utils"),d=o("./stream/GenericWorker"),h=s?"uint8array":"array";function u(g,_){d.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=_,this.meta={}}f.magic="\b\0",n.inherits(u,d),u.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(n.transformTo(h,g.data),!1)},u.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(_){g.push({data:_,meta:g.meta})}},f.compressWorker=function(g){return new u("Deflate",g)},f.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(o,y,f){function s(i,p){var t,l="";for(t=0;t<p;t++)l+=String.fromCharCode(255&i),i>>>=8;return l}function a(i,p,t,l,c,b){var S,A,j=i.file,O=i.compression,I=b!==h.utf8encode,U=n.transformTo("string",b(j.name)),L=n.transformTo("string",h.utf8encode(j.name)),$=j.comment,J=n.transformTo("string",b($)),k=n.transformTo("string",h.utf8encode($)),F=L.length!==j.name.length,r=k.length!==$.length,B="",te="",H="",re=j.dir,W=j.date,ee={crc32:0,compressedSize:0,uncompressedSize:0};p&&!t||(ee.crc32=i.crc32,ee.compressedSize=i.compressedSize,ee.uncompressedSize=i.uncompressedSize);var R=0;p&&(R|=8),I||!F&&!r||(R|=2048);var z=0,V=0;re&&(z|=16),c==="UNIX"?(V=798,z|=(function(K,oe){var ue=K;return K||(ue=oe?16893:33204),(65535&ue)<<16})(j.unixPermissions,re)):(V=20,z|=(function(K){return 63&(K||0)})(j.dosPermissions)),S=W.getUTCHours(),S<<=6,S|=W.getUTCMinutes(),S<<=5,S|=W.getUTCSeconds()/2,A=W.getUTCFullYear()-1980,A<<=4,A|=W.getUTCMonth()+1,A<<=5,A|=W.getUTCDate(),F&&(te=s(1,1)+s(u(U),4)+L,B+="up"+s(te.length,2)+te),r&&(H=s(1,1)+s(u(J),4)+k,B+="uc"+s(H.length,2)+H);var Y="";return Y+=`
\0`,Y+=s(R,2),Y+=O.magic,Y+=s(S,2),Y+=s(A,2),Y+=s(ee.crc32,4),Y+=s(ee.compressedSize,4),Y+=s(ee.uncompressedSize,4),Y+=s(U.length,2),Y+=s(B.length,2),{fileRecord:g.LOCAL_FILE_HEADER+Y+U+B,dirRecord:g.CENTRAL_FILE_HEADER+s(V,2)+Y+s(J.length,2)+"\0\0\0\0"+s(z,4)+s(l,4)+U+B+J}}var n=o("../utils"),d=o("../stream/GenericWorker"),h=o("../utf8"),u=o("../crc32"),g=o("../signature");function _(i,p,t,l){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=t,this.encodeFileName=l,this.streamFiles=i,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(_,d),_.prototype.push=function(i){var p=i.meta.percent||0,t=this.entriesCount,l=this._sources.length;this.accumulate?this.contentBuffer.push(i):(this.bytesWritten+=i.data.length,d.prototype.push.call(this,{data:i.data,meta:{currentFile:this.currentFile,percent:t?(p+100*(t-l-1))/t:100}}))},_.prototype.openedSource=function(i){this.currentSourceOffset=this.bytesWritten,this.currentFile=i.file.name;var p=this.streamFiles&&!i.file.dir;if(p){var t=a(i,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:t.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(i){this.accumulate=!1;var p=this.streamFiles&&!i.file.dir,t=a(i,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(t.dirRecord),p)this.push({data:(function(l){return g.DATA_DESCRIPTOR+s(l.crc32,4)+s(l.compressedSize,4)+s(l.uncompressedSize,4)})(i),meta:{percent:100}});else for(this.push({data:t.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var i=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var t=this.bytesWritten-i,l=(function(c,b,S,A,j){var O=n.transformTo("string",j(A));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(c,2)+s(c,2)+s(b,4)+s(S,4)+s(O.length,2)+O})(this.dirRecords.length,t,i,this.zipComment,this.encodeFileName);this.push({data:l,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(i){this._sources.push(i);var p=this;return i.on("data",function(t){p.processChunk(t)}),i.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),i.on("error",function(t){p.error(t)}),this},_.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(i){var p=this._sources;if(!d.prototype.error.call(this,i))return!1;for(var t=0;t<p.length;t++)try{p[t].error(i)}catch{}return!0},_.prototype.lock=function(){d.prototype.lock.call(this);for(var i=this._sources,p=0;p<i.length;p++)i[p].lock()},y.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(o,y,f){var s=o("../compressions"),a=o("./ZipFileWorker");f.generateWorker=function(n,d,h){var u=new a(d.streamFiles,h,d.platform,d.encodeFileName),g=0;try{n.forEach(function(_,i){g++;var p=(function(b,S){var A=b||S,j=s[A];if(!j)throw new Error(A+" is not a valid compression method !");return j})(i.options.compression,d.compression),t=i.options.compressionOptions||d.compressionOptions||{},l=i.dir,c=i.date;i._compressWorker(p,t).withStreamInfo("file",{name:_,dir:l,date:c,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(u)}),u.entriesCount=g}catch(_){u.error(_)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(o,y,f){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new s;for(var n in this)typeof this[n]!="function"&&(a[n]=this[n]);return a}}(s.prototype=o("./object")).loadAsync=o("./load"),s.support=o("./support"),s.defaults=o("./defaults"),s.version="3.10.1",s.loadAsync=function(a,n){return new s().loadAsync(a,n)},s.external=o("./external"),y.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(o,y,f){var s=o("./utils"),a=o("./external"),n=o("./utf8"),d=o("./zipEntries"),h=o("./stream/Crc32Probe"),u=o("./nodejsUtils");function g(_){return new a.Promise(function(i,p){var t=_.decompressed.getContentWorker().pipe(new h);t.on("error",function(l){p(l)}).on("end",function(){t.streamInfo.crc32!==_.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):i()}).resume()})}y.exports=function(_,i){var p=this;return i=s.extend(i||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),u.isNode&&u.isStream(_)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",_,!0,i.optimizedBinaryString,i.base64).then(function(t){var l=new d(i);return l.load(t),l}).then(function(t){var l=[a.Promise.resolve(t)],c=t.files;if(i.checkCRC32)for(var b=0;b<c.length;b++)l.push(g(c[b]));return a.Promise.all(l)}).then(function(t){for(var l=t.shift(),c=l.files,b=0;b<c.length;b++){var S=c[b],A=S.fileNameStr,j=s.resolve(S.fileNameStr);p.file(j,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:i.createFolders}),S.dir||(p.file(j).unsafeOriginalName=A)}return l.zipComment.length&&(p.comment=l.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(o,y,f){var s=o("../utils"),a=o("../stream/GenericWorker");function n(d,h){a.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(h)}s.inherits(n,a),n.prototype._bindStream=function(d){var h=this;(this._stream=d).pause(),d.on("data",function(u){h.push({data:u,meta:{percent:0}})}).on("error",function(u){h.isPaused?this.generatedError=u:h.error(u)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},n.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},y.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(o,y,f){var s=o("readable-stream").Readable;function a(n,d,h){s.call(this,d),this._helper=n;var u=this;n.on("data",function(g,_){u.push(g)||u._helper.pause(),h&&h(_)}).on("error",function(g){u.emit("error",g)}).on("end",function(){u.push(null)})}o("../utils").inherits(a,s),a.prototype._read=function(){this._helper.resume()},y.exports=a},{"../utils":32,"readable-stream":16}],14:[function(o,y,f){y.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,a);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,a)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var a=new Buffer(s);return a.fill(0),a},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(o,y,f){function s(j,O,I){var U,L=n.getTypeOf(O),$=n.extend(I||{},u);$.date=$.date||new Date,$.compression!==null&&($.compression=$.compression.toUpperCase()),typeof $.unixPermissions=="string"&&($.unixPermissions=parseInt($.unixPermissions,8)),$.unixPermissions&&16384&$.unixPermissions&&($.dir=!0),$.dosPermissions&&16&$.dosPermissions&&($.dir=!0),$.dir&&(j=c(j)),$.createFolders&&(U=l(j))&&b.call(this,U,!0);var J=L==="string"&&$.binary===!1&&$.base64===!1;I&&I.binary!==void 0||($.binary=!J),(O instanceof g&&O.uncompressedSize===0||$.dir||!O||O.length===0)&&($.base64=!1,$.binary=!0,O="",$.compression="STORE",L="string");var k=null;k=O instanceof g||O instanceof d?O:p.isNode&&p.isStream(O)?new t(j,O):n.prepareContent(j,O,$.binary,$.optimizedBinaryString,$.base64);var F=new _(j,k,$);this.files[j]=F}var a=o("./utf8"),n=o("./utils"),d=o("./stream/GenericWorker"),h=o("./stream/StreamHelper"),u=o("./defaults"),g=o("./compressedObject"),_=o("./zipObject"),i=o("./generate"),p=o("./nodejsUtils"),t=o("./nodejs/NodejsStreamInputAdapter"),l=function(j){j.slice(-1)==="/"&&(j=j.substring(0,j.length-1));var O=j.lastIndexOf("/");return 0<O?j.substring(0,O):""},c=function(j){return j.slice(-1)!=="/"&&(j+="/"),j},b=function(j,O){return O=O!==void 0?O:u.createFolders,j=c(j),this.files[j]||s.call(this,j,null,{dir:!0,createFolders:O}),this.files[j]};function S(j){return Object.prototype.toString.call(j)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(j){var O,I,U;for(O in this.files)U=this.files[O],(I=O.slice(this.root.length,O.length))&&O.slice(0,this.root.length)===this.root&&j(I,U)},filter:function(j){var O=[];return this.forEach(function(I,U){j(I,U)&&O.push(U)}),O},file:function(j,O,I){if(arguments.length!==1)return j=this.root+j,s.call(this,j,O,I),this;if(S(j)){var U=j;return this.filter(function($,J){return!J.dir&&U.test($)})}var L=this.files[this.root+j];return L&&!L.dir?L:null},folder:function(j){if(!j)return this;if(S(j))return this.filter(function(L,$){return $.dir&&j.test(L)});var O=this.root+j,I=b.call(this,O),U=this.clone();return U.root=I.name,U},remove:function(j){j=this.root+j;var O=this.files[j];if(O||(j.slice(-1)!=="/"&&(j+="/"),O=this.files[j]),O&&!O.dir)delete this.files[j];else for(var I=this.filter(function(L,$){return $.name.slice(0,j.length)===j}),U=0;U<I.length;U++)delete this.files[I[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(j){var O,I={};try{if((I=n.extend(j||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=I.type.toLowerCase(),I.compression=I.compression.toUpperCase(),I.type==="binarystring"&&(I.type="string"),!I.type)throw new Error("No output type specified.");n.checkSupport(I.type),I.platform!=="darwin"&&I.platform!=="freebsd"&&I.platform!=="linux"&&I.platform!=="sunos"||(I.platform="UNIX"),I.platform==="win32"&&(I.platform="DOS");var U=I.comment||this.comment||"";O=i.generateWorker(this,I,U)}catch(L){(O=new d("error")).error(L)}return new h(O,I.type||"string",I.mimeType)},generateAsync:function(j,O){return this.generateInternalStream(j).accumulate(O)},generateNodeStream:function(j,O){return(j=j||{}).type||(j.type="nodebuffer"),this.generateInternalStream(j).toNodejsStream(O)}};y.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(o,y,f){y.exports=o("stream")},{stream:void 0}],17:[function(o,y,f){var s=o("./DataReader");function a(n){s.call(this,n);for(var d=0;d<this.data.length;d++)n[d]=255&n[d]}o("../utils").inherits(a,s),a.prototype.byteAt=function(n){return this.data[this.zero+n]},a.prototype.lastIndexOfSignature=function(n){for(var d=n.charCodeAt(0),h=n.charCodeAt(1),u=n.charCodeAt(2),g=n.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===d&&this.data[_+1]===h&&this.data[_+2]===u&&this.data[_+3]===g)return _-this.zero;return-1},a.prototype.readAndCheckSignature=function(n){var d=n.charCodeAt(0),h=n.charCodeAt(1),u=n.charCodeAt(2),g=n.charCodeAt(3),_=this.readData(4);return d===_[0]&&h===_[1]&&u===_[2]&&g===_[3]},a.prototype.readData=function(n){if(this.checkOffset(n),n===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,d},y.exports=a},{"../utils":32,"./DataReader":18}],18:[function(o,y,f){var s=o("../utils");function a(n){this.data=n,this.length=n.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(n){this.checkIndex(this.index+n)},checkIndex:function(n){if(this.length<this.zero+n||n<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+n+"). Corrupted zip ?")},setIndex:function(n){this.checkIndex(n),this.index=n},skip:function(n){this.setIndex(this.index+n)},byteAt:function(){},readInt:function(n){var d,h=0;for(this.checkOffset(n),d=this.index+n-1;d>=this.index;d--)h=(h<<8)+this.byteAt(d);return this.index+=n,h},readString:function(n){return s.transformTo("string",this.readData(n))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var n=this.readInt(4);return new Date(Date.UTC(1980+(n>>25&127),(n>>21&15)-1,n>>16&31,n>>11&31,n>>5&63,(31&n)<<1))}},y.exports=a},{"../utils":32}],19:[function(o,y,f){var s=o("./Uint8ArrayReader");function a(n){s.call(this,n)}o("../utils").inherits(a,s),a.prototype.readData=function(n){this.checkOffset(n);var d=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,d},y.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(o,y,f){var s=o("./DataReader");function a(n){s.call(this,n)}o("../utils").inherits(a,s),a.prototype.byteAt=function(n){return this.data.charCodeAt(this.zero+n)},a.prototype.lastIndexOfSignature=function(n){return this.data.lastIndexOf(n)-this.zero},a.prototype.readAndCheckSignature=function(n){return n===this.readData(4)},a.prototype.readData=function(n){this.checkOffset(n);var d=this.data.slice(this.zero+this.index,this.zero+this.index+n);return this.index+=n,d},y.exports=a},{"../utils":32,"./DataReader":18}],21:[function(o,y,f){var s=o("./ArrayReader");function a(n){s.call(this,n)}o("../utils").inherits(a,s),a.prototype.readData=function(n){if(this.checkOffset(n),n===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+n);return this.index+=n,d},y.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(o,y,f){var s=o("../utils"),a=o("../support"),n=o("./ArrayReader"),d=o("./StringReader"),h=o("./NodeBufferReader"),u=o("./Uint8ArrayReader");y.exports=function(g){var _=s.getTypeOf(g);return s.checkSupport(_),_!=="string"||a.uint8array?_==="nodebuffer"?new h(g):a.uint8array?new u(s.transformTo("uint8array",g)):new n(s.transformTo("array",g)):new d(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(o,y,f){f.LOCAL_FILE_HEADER="PK",f.CENTRAL_FILE_HEADER="PK",f.CENTRAL_DIRECTORY_END="PK",f.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",f.ZIP64_CENTRAL_DIRECTORY_END="PK",f.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(o,y,f){var s=o("./GenericWorker"),a=o("../utils");function n(d){s.call(this,"ConvertWorker to "+d),this.destType=d}a.inherits(n,s),n.prototype.processChunk=function(d){this.push({data:a.transformTo(this.destType,d.data),meta:d.meta})},y.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(o,y,f){var s=o("./GenericWorker"),a=o("../crc32");function n(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}o("../utils").inherits(n,s),n.prototype.processChunk=function(d){this.streamInfo.crc32=a(d.data,this.streamInfo.crc32||0),this.push(d)},y.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(o,y,f){var s=o("../utils"),a=o("./GenericWorker");function n(d){a.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}s.inherits(n,a),n.prototype.processChunk=function(d){if(d){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+d.data.length}a.prototype.processChunk.call(this,d)},y.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(o,y,f){var s=o("../utils"),a=o("./GenericWorker");function n(d){a.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(u){h.dataIsReady=!0,h.data=u,h.max=u&&u.length||0,h.type=s.getTypeOf(u),h.isPaused||h._tickAndRepeat()},function(u){h.error(u)})}s.inherits(n,a),n.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,h);break;case"uint8array":d=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":d=this.data.slice(this.index,h)}return this.index=h,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},y.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(o,y,f){function s(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,n){return this._listeners[a].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,n){if(this._listeners[a])for(var d=0;d<this._listeners[a].length;d++)this._listeners[a][d].call(this,n)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var n=this;return a.on("data",function(d){n.processChunk(d)}),a.on("end",function(){n.end()}),a.on("error",function(d){n.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,n){return this.extraStreamInfo[a]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},y.exports=s},{}],29:[function(o,y,f){var s=o("../utils"),a=o("./ConvertWorker"),n=o("./GenericWorker"),d=o("../base64"),h=o("../support"),u=o("../external"),g=null;if(h.nodestream)try{g=o("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(p,t){return new u.Promise(function(l,c){var b=[],S=p._internalType,A=p._outputType,j=p._mimeType;p.on("data",function(O,I){b.push(O),t&&t(I)}).on("error",function(O){b=[],c(O)}).on("end",function(){try{var O=(function(I,U,L){switch(I){case"blob":return s.newBlob(s.transformTo("arraybuffer",U),L);case"base64":return d.encode(U);default:return s.transformTo(I,U)}})(A,(function(I,U){var L,$=0,J=null,k=0;for(L=0;L<U.length;L++)k+=U[L].length;switch(I){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(J=new Uint8Array(k),L=0;L<U.length;L++)J.set(U[L],$),$+=U[L].length;return J;case"nodebuffer":return Buffer.concat(U);default:throw new Error("concat : unsupported type '"+I+"'")}})(S,b),j);l(O)}catch(I){c(I)}b=[]}).resume()})}function i(p,t,l){var c=t;switch(t){case"blob":case"arraybuffer":c="uint8array";break;case"base64":c="string"}try{this._internalType=c,this._outputType=t,this._mimeType=l,s.checkSupport(c),this._worker=p.pipe(new a(c)),p.lock()}catch(b){this._worker=new n("error"),this._worker.error(b)}}i.prototype={accumulate:function(p){return _(this,p)},on:function(p,t){var l=this;return p==="data"?this._worker.on(p,function(c){t.call(l,c.data,c.meta)}):this._worker.on(p,function(){s.delay(t,arguments,l)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},p)}},y.exports=i},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(o,y,f){if(f.base64=!0,f.array=!0,f.string=!0,f.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",f.nodebuffer=typeof Buffer<"u",f.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")f.blob=!1;else{var s=new ArrayBuffer(0);try{f.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(s),f.blob=a.getBlob("application/zip").size===0}catch{f.blob=!1}}}try{f.nodestream=!!o("readable-stream").Readable}catch{f.nodestream=!1}},{"readable-stream":16}],31:[function(o,y,f){for(var s=o("./utils"),a=o("./support"),n=o("./nodejsUtils"),d=o("./stream/GenericWorker"),h=new Array(256),u=0;u<256;u++)h[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;h[254]=h[254]=1;function g(){d.call(this,"utf-8 decode"),this.leftOver=null}function _(){d.call(this,"utf-8 encode")}f.utf8encode=function(i){return a.nodebuffer?n.newBufferFrom(i,"utf-8"):(function(p){var t,l,c,b,S,A=p.length,j=0;for(b=0;b<A;b++)(64512&(l=p.charCodeAt(b)))==55296&&b+1<A&&(64512&(c=p.charCodeAt(b+1)))==56320&&(l=65536+(l-55296<<10)+(c-56320),b++),j+=l<128?1:l<2048?2:l<65536?3:4;for(t=a.uint8array?new Uint8Array(j):new Array(j),b=S=0;S<j;b++)(64512&(l=p.charCodeAt(b)))==55296&&b+1<A&&(64512&(c=p.charCodeAt(b+1)))==56320&&(l=65536+(l-55296<<10)+(c-56320),b++),l<128?t[S++]=l:(l<2048?t[S++]=192|l>>>6:(l<65536?t[S++]=224|l>>>12:(t[S++]=240|l>>>18,t[S++]=128|l>>>12&63),t[S++]=128|l>>>6&63),t[S++]=128|63&l);return t})(i)},f.utf8decode=function(i){return a.nodebuffer?s.transformTo("nodebuffer",i).toString("utf-8"):(function(p){var t,l,c,b,S=p.length,A=new Array(2*S);for(t=l=0;t<S;)if((c=p[t++])<128)A[l++]=c;else if(4<(b=h[c]))A[l++]=65533,t+=b-1;else{for(c&=b===2?31:b===3?15:7;1<b&&t<S;)c=c<<6|63&p[t++],b--;1<b?A[l++]=65533:c<65536?A[l++]=c:(c-=65536,A[l++]=55296|c>>10&1023,A[l++]=56320|1023&c)}return A.length!==l&&(A.subarray?A=A.subarray(0,l):A.length=l),s.applyFromCharCode(A)})(i=s.transformTo(a.uint8array?"uint8array":"array",i))},s.inherits(g,d),g.prototype.processChunk=function(i){var p=s.transformTo(a.uint8array?"uint8array":"array",i.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var t=p;(p=new Uint8Array(t.length+this.leftOver.length)).set(this.leftOver,0),p.set(t,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var l=(function(b,S){var A;for((S=S||b.length)>b.length&&(S=b.length),A=S-1;0<=A&&(192&b[A])==128;)A--;return A<0||A===0?S:A+h[b[A]]>S?A:S})(p),c=p;l!==p.length&&(a.uint8array?(c=p.subarray(0,l),this.leftOver=p.subarray(l,p.length)):(c=p.slice(0,l),this.leftOver=p.slice(l,p.length))),this.push({data:f.utf8decode(c),meta:i.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:f.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},f.Utf8DecodeWorker=g,s.inherits(_,d),_.prototype.processChunk=function(i){this.push({data:f.utf8encode(i.data),meta:i.meta})},f.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(o,y,f){var s=o("./support"),a=o("./base64"),n=o("./nodejsUtils"),d=o("./external");function h(t){return t}function u(t,l){for(var c=0;c<t.length;++c)l[c]=255&t.charCodeAt(c);return l}o("setimmediate"),f.newBlob=function(t,l){f.checkSupport("blob");try{return new Blob([t],{type:l})}catch{try{var c=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return c.append(t),c.getBlob(l)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(t,l,c){var b=[],S=0,A=t.length;if(A<=c)return String.fromCharCode.apply(null,t);for(;S<A;)l==="array"||l==="nodebuffer"?b.push(String.fromCharCode.apply(null,t.slice(S,Math.min(S+c,A)))):b.push(String.fromCharCode.apply(null,t.subarray(S,Math.min(S+c,A)))),S+=c;return b.join("")},stringifyByChar:function(t){for(var l="",c=0;c<t.length;c++)l+=String.fromCharCode(t[c]);return l},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,n.allocBuffer(1)).length===1}catch{return!1}})()}};function _(t){var l=65536,c=f.getTypeOf(t),b=!0;if(c==="uint8array"?b=g.applyCanBeUsed.uint8array:c==="nodebuffer"&&(b=g.applyCanBeUsed.nodebuffer),b)for(;1<l;)try{return g.stringifyByChunk(t,c,l)}catch{l=Math.floor(l/2)}return g.stringifyByChar(t)}function i(t,l){for(var c=0;c<t.length;c++)l[c]=t[c];return l}f.applyFromCharCode=_;var p={};p.string={string:h,array:function(t){return u(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return u(t,new Uint8Array(t.length))},nodebuffer:function(t){return u(t,n.allocBuffer(t.length))}},p.array={string:_,array:h,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return n.newBufferFrom(t)}},p.arraybuffer={string:function(t){return _(new Uint8Array(t))},array:function(t){return i(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:h,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return n.newBufferFrom(new Uint8Array(t))}},p.uint8array={string:_,array:function(t){return i(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:h,nodebuffer:function(t){return n.newBufferFrom(t)}},p.nodebuffer={string:_,array:function(t){return i(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return i(t,new Uint8Array(t.length))},nodebuffer:h},f.transformTo=function(t,l){if(l=l||"",!t)return l;f.checkSupport(t);var c=f.getTypeOf(l);return p[c][t](l)},f.resolve=function(t){for(var l=t.split("/"),c=[],b=0;b<l.length;b++){var S=l[b];S==="."||S===""&&b!==0&&b!==l.length-1||(S===".."?c.pop():c.push(S))}return c.join("/")},f.getTypeOf=function(t){return typeof t=="string"?"string":Object.prototype.toString.call(t)==="[object Array]"?"array":s.nodebuffer&&n.isBuffer(t)?"nodebuffer":s.uint8array&&t instanceof Uint8Array?"uint8array":s.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},f.checkSupport=function(t){if(!s[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},f.MAX_VALUE_16BITS=65535,f.MAX_VALUE_32BITS=-1,f.pretty=function(t){var l,c,b="";for(c=0;c<(t||"").length;c++)b+="\\x"+((l=t.charCodeAt(c))<16?"0":"")+l.toString(16).toUpperCase();return b},f.delay=function(t,l,c){setImmediate(function(){t.apply(c||null,l||[])})},f.inherits=function(t,l){function c(){}c.prototype=l.prototype,t.prototype=new c},f.extend=function(){var t,l,c={};for(t=0;t<arguments.length;t++)for(l in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],l)&&c[l]===void 0&&(c[l]=arguments[t][l]);return c},f.prepareContent=function(t,l,c,b,S){return d.Promise.resolve(l).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new d.Promise(function(j,O){var I=new FileReader;I.onload=function(U){j(U.target.result)},I.onerror=function(U){O(U.target.error)},I.readAsArrayBuffer(A)}):A}).then(function(A){var j=f.getTypeOf(A);return j?(j==="arraybuffer"?A=f.transformTo("uint8array",A):j==="string"&&(S?A=a.decode(A):c&&b!==!0&&(A=(function(O){return u(O,s.uint8array?new Uint8Array(O.length):new Array(O.length))})(A))),A):d.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(o,y,f){var s=o("./reader/readerFor"),a=o("./utils"),n=o("./signature"),d=o("./zipEntry"),h=o("./support");function u(g){this.files=[],this.loadOptions=g}u.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(_)+", expected "+a.pretty(g)+")")}},isSignature:function(g,_){var i=this.reader.index;this.reader.setIndex(g);var p=this.reader.readString(4)===_;return this.reader.setIndex(i),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),_=h.uint8array?"uint8array":"array",i=a.transformTo(_,g);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,_,i,p=this.zip64EndOfCentralSize-44;0<p;)g=this.reader.readInt(2),_=this.reader.readInt(4),i=this.reader.readData(_),this.zip64ExtensibleData[g]={id:g,length:_,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,_;for(g=0;g<this.files.length;g++)_=this.files[g],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(g=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var _=g;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var p=_-i;if(0<p)this.isSignature(_,n.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(g){this.reader=s(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},y.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(o,y,f){var s=o("./reader/readerFor"),a=o("./utils"),n=o("./compressedObject"),d=o("./crc32"),h=o("./utf8"),u=o("./compressions"),g=o("./support");function _(i,p){this.options=i,this.loadOptions=p}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(i){var p,t;if(i.skip(22),this.fileNameLength=i.readInt(2),t=i.readInt(2),this.fileName=i.readData(this.fileNameLength),i.skip(t),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=(function(l){for(var c in u)if(Object.prototype.hasOwnProperty.call(u,c)&&u[c].magic===l)return u[c];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,p,i.readData(this.compressedSize))},readCentralPart:function(i){this.versionMadeBy=i.readInt(2),i.skip(2),this.bitFlag=i.readInt(2),this.compressionMethod=i.readString(2),this.date=i.readDate(),this.crc32=i.readInt(4),this.compressedSize=i.readInt(4),this.uncompressedSize=i.readInt(4);var p=i.readInt(2);if(this.extraFieldsLength=i.readInt(2),this.fileCommentLength=i.readInt(2),this.diskNumberStart=i.readInt(2),this.internalFileAttributes=i.readInt(2),this.externalFileAttributes=i.readInt(4),this.localHeaderOffset=i.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");i.skip(p),this.readExtraFields(i),this.parseZIP64ExtraField(i),this.fileComment=i.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var i=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),i==0&&(this.dosPermissions=63&this.externalFileAttributes),i==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var i=s(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=i.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=i.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=i.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=i.readInt(4))}},readExtraFields:function(i){var p,t,l,c=i.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});i.index+4<c;)p=i.readInt(2),t=i.readInt(2),l=i.readData(t),this.extraFields[p]={id:p,length:t,value:l};i.setIndex(c)},handleUTF8:function(){var i=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var t=a.transformTo(i,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(t)}var l=this.findExtraFieldUnicodeComment();if(l!==null)this.fileCommentStr=l;else{var c=a.transformTo(i,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(c)}}},findExtraFieldUnicodePath:function(){var i=this.extraFields[28789];if(i){var p=s(i.value);return p.readInt(1)!==1||d(this.fileName)!==p.readInt(4)?null:h.utf8decode(p.readData(i.length-5))}return null},findExtraFieldUnicodeComment:function(){var i=this.extraFields[25461];if(i){var p=s(i.value);return p.readInt(1)!==1||d(this.fileComment)!==p.readInt(4)?null:h.utf8decode(p.readData(i.length-5))}return null}},y.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(o,y,f){function s(p,t,l){this.name=p,this.dir=l.dir,this.date=l.date,this.comment=l.comment,this.unixPermissions=l.unixPermissions,this.dosPermissions=l.dosPermissions,this._data=t,this._dataBinary=l.binary,this.options={compression:l.compression,compressionOptions:l.compressionOptions}}var a=o("./stream/StreamHelper"),n=o("./stream/DataWorker"),d=o("./utf8"),h=o("./compressedObject"),u=o("./stream/GenericWorker");s.prototype={internalStream:function(p){var t=null,l="string";try{if(!p)throw new Error("No output type specified.");var c=(l=p.toLowerCase())==="string"||l==="text";l!=="binarystring"&&l!=="text"||(l="string"),t=this._decompressWorker();var b=!this._dataBinary;b&&!c&&(t=t.pipe(new d.Utf8EncodeWorker)),!b&&c&&(t=t.pipe(new d.Utf8DecodeWorker))}catch(S){(t=new u("error")).error(S)}return new a(t,l,"")},async:function(p,t){return this.internalStream(p).accumulate(t)},nodeStream:function(p,t){return this.internalStream(p||"nodebuffer").toNodejsStream(t)},_compressWorker:function(p,t){if(this._data instanceof h&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var l=this._decompressWorker();return this._dataBinary||(l=l.pipe(new d.Utf8EncodeWorker)),h.createWorkerFrom(l,p,t)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof u?this._data:new n(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},i=0;i<g.length;i++)s.prototype[g[i]]=_;y.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(o,y,f){(function(s){var a,n,d=s.MutationObserver||s.WebKitMutationObserver;if(d){var h=0,u=new d(p),g=s.document.createTextNode("");u.observe(g,{characterData:!0}),a=function(){g.data=h=++h%2}}else if(s.setImmediate||s.MessageChannel===void 0)a="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var t=s.document.createElement("script");t.onreadystatechange=function(){p(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},s.document.documentElement.appendChild(t)}:function(){setTimeout(p,0)};else{var _=new s.MessageChannel;_.port1.onmessage=p,a=function(){_.port2.postMessage(0)}}var i=[];function p(){var t,l;n=!0;for(var c=i.length;c;){for(l=i,i=[],t=-1;++t<c;)l[t]();c=i.length}n=!1}y.exports=function(t){i.push(t)!==1||n||a()}}).call(this,typeof ve<"u"?ve:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(o,y,f){var s=o("immediate");function a(){}var n={},d=["REJECTED"],h=["FULFILLED"],u=["PENDING"];function g(c){if(typeof c!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,c!==a&&t(this,c)}function _(c,b,S){this.promise=c,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function i(c,b,S){s(function(){var A;try{A=b(S)}catch(j){return n.reject(c,j)}A===c?n.reject(c,new TypeError("Cannot resolve promise with itself")):n.resolve(c,A)})}function p(c){var b=c&&c.then;if(c&&(typeof c=="object"||typeof c=="function")&&typeof b=="function")return function(){b.apply(c,arguments)}}function t(c,b){var S=!1;function A(I){S||(S=!0,n.reject(c,I))}function j(I){S||(S=!0,n.resolve(c,I))}var O=l(function(){b(j,A)});O.status==="error"&&A(O.value)}function l(c,b){var S={};try{S.value=c(b),S.status="success"}catch(A){S.status="error",S.value=A}return S}(y.exports=g).prototype.finally=function(c){if(typeof c!="function")return this;var b=this.constructor;return this.then(function(S){return b.resolve(c()).then(function(){return S})},function(S){return b.resolve(c()).then(function(){throw S})})},g.prototype.catch=function(c){return this.then(null,c)},g.prototype.then=function(c,b){if(typeof c!="function"&&this.state===h||typeof b!="function"&&this.state===d)return this;var S=new this.constructor(a);return this.state!==u?i(S,this.state===h?c:b,this.outcome):this.queue.push(new _(S,c,b)),S},_.prototype.callFulfilled=function(c){n.resolve(this.promise,c)},_.prototype.otherCallFulfilled=function(c){i(this.promise,this.onFulfilled,c)},_.prototype.callRejected=function(c){n.reject(this.promise,c)},_.prototype.otherCallRejected=function(c){i(this.promise,this.onRejected,c)},n.resolve=function(c,b){var S=l(p,b);if(S.status==="error")return n.reject(c,S.value);var A=S.value;if(A)t(c,A);else{c.state=h,c.outcome=b;for(var j=-1,O=c.queue.length;++j<O;)c.queue[j].callFulfilled(b)}return c},n.reject=function(c,b){c.state=d,c.outcome=b;for(var S=-1,A=c.queue.length;++S<A;)c.queue[S].callRejected(b);return c},g.resolve=function(c){return c instanceof this?c:n.resolve(new this(a),c)},g.reject=function(c){var b=new this(a);return n.reject(b,c)},g.all=function(c){var b=this;if(Object.prototype.toString.call(c)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=c.length,A=!1;if(!S)return this.resolve([]);for(var j=new Array(S),O=0,I=-1,U=new this(a);++I<S;)L(c[I],I);return U;function L($,J){b.resolve($).then(function(k){j[J]=k,++O!==S||A||(A=!0,n.resolve(U,j))},function(k){A||(A=!0,n.reject(U,k))})}},g.race=function(c){var b=this;if(Object.prototype.toString.call(c)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=c.length,A=!1;if(!S)return this.resolve([]);for(var j=-1,O=new this(a);++j<S;)I=c[j],b.resolve(I).then(function(U){A||(A=!0,n.resolve(O,U))},function(U){A||(A=!0,n.reject(O,U))});var I;return O}},{immediate:36}],38:[function(o,y,f){var s={};(0,o("./lib/utils/common").assign)(s,o("./lib/deflate"),o("./lib/inflate"),o("./lib/zlib/constants")),y.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(o,y,f){var s=o("./zlib/deflate"),a=o("./utils/common"),n=o("./utils/strings"),d=o("./zlib/messages"),h=o("./zlib/zstream"),u=Object.prototype.toString,g=0,_=-1,i=0,p=8;function t(c){if(!(this instanceof t))return new t(c);this.options=a.assign({level:_,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:i,to:""},c||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var S=s.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(S!==g)throw new Error(d[S]);if(b.header&&s.deflateSetHeader(this.strm,b.header),b.dictionary){var A;if(A=typeof b.dictionary=="string"?n.string2buf(b.dictionary):u.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(S=s.deflateSetDictionary(this.strm,A))!==g)throw new Error(d[S]);this._dict_set=!0}}function l(c,b){var S=new t(b);if(S.push(c,!0),S.err)throw S.msg||d[S.err];return S.result}t.prototype.push=function(c,b){var S,A,j=this.strm,O=this.options.chunkSize;if(this.ended)return!1;A=b===~~b?b:b===!0?4:0,typeof c=="string"?j.input=n.string2buf(c):u.call(c)==="[object ArrayBuffer]"?j.input=new Uint8Array(c):j.input=c,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new a.Buf8(O),j.next_out=0,j.avail_out=O),(S=s.deflate(j,A))!==1&&S!==g)return this.onEnd(S),!(this.ended=!0);j.avail_out!==0&&(j.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(n.buf2binstring(a.shrinkBuf(j.output,j.next_out))):this.onData(a.shrinkBuf(j.output,j.next_out)))}while((0<j.avail_in||j.avail_out===0)&&S!==1);return A===4?(S=s.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===g):A!==2||(this.onEnd(g),!(j.avail_out=0))},t.prototype.onData=function(c){this.chunks.push(c)},t.prototype.onEnd=function(c){c===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},f.Deflate=t,f.deflate=l,f.deflateRaw=function(c,b){return(b=b||{}).raw=!0,l(c,b)},f.gzip=function(c,b){return(b=b||{}).gzip=!0,l(c,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(o,y,f){var s=o("./zlib/inflate"),a=o("./utils/common"),n=o("./utils/strings"),d=o("./zlib/constants"),h=o("./zlib/messages"),u=o("./zlib/zstream"),g=o("./zlib/gzheader"),_=Object.prototype.toString;function i(t){if(!(this instanceof i))return new i(t);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var l=this.options;l.raw&&0<=l.windowBits&&l.windowBits<16&&(l.windowBits=-l.windowBits,l.windowBits===0&&(l.windowBits=-15)),!(0<=l.windowBits&&l.windowBits<16)||t&&t.windowBits||(l.windowBits+=32),15<l.windowBits&&l.windowBits<48&&(15&l.windowBits)==0&&(l.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var c=s.inflateInit2(this.strm,l.windowBits);if(c!==d.Z_OK)throw new Error(h[c]);this.header=new g,s.inflateGetHeader(this.strm,this.header)}function p(t,l){var c=new i(l);if(c.push(t,!0),c.err)throw c.msg||h[c.err];return c.result}i.prototype.push=function(t,l){var c,b,S,A,j,O,I=this.strm,U=this.options.chunkSize,L=this.options.dictionary,$=!1;if(this.ended)return!1;b=l===~~l?l:l===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof t=="string"?I.input=n.binstring2buf(t):_.call(t)==="[object ArrayBuffer]"?I.input=new Uint8Array(t):I.input=t,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new a.Buf8(U),I.next_out=0,I.avail_out=U),(c=s.inflate(I,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&L&&(O=typeof L=="string"?n.string2buf(L):_.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,c=s.inflateSetDictionary(this.strm,O)),c===d.Z_BUF_ERROR&&$===!0&&(c=d.Z_OK,$=!1),c!==d.Z_STREAM_END&&c!==d.Z_OK)return this.onEnd(c),!(this.ended=!0);I.next_out&&(I.avail_out!==0&&c!==d.Z_STREAM_END&&(I.avail_in!==0||b!==d.Z_FINISH&&b!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=n.utf8border(I.output,I.next_out),A=I.next_out-S,j=n.buf2string(I.output,S),I.next_out=A,I.avail_out=U-A,A&&a.arraySet(I.output,I.output,S,A,0),this.onData(j)):this.onData(a.shrinkBuf(I.output,I.next_out)))),I.avail_in===0&&I.avail_out===0&&($=!0)}while((0<I.avail_in||I.avail_out===0)&&c!==d.Z_STREAM_END);return c===d.Z_STREAM_END&&(b=d.Z_FINISH),b===d.Z_FINISH?(c=s.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===d.Z_OK):b!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(I.avail_out=0))},i.prototype.onData=function(t){this.chunks.push(t)},i.prototype.onEnd=function(t){t===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},f.Inflate=i,f.inflate=p,f.inflateRaw=function(t,l){return(l=l||{}).raw=!0,p(t,l)},f.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(o,y,f){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";f.assign=function(d){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var u=h.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var g in u)u.hasOwnProperty(g)&&(d[g]=u[g])}}return d},f.shrinkBuf=function(d,h){return d.length===h?d:d.subarray?d.subarray(0,h):(d.length=h,d)};var a={arraySet:function(d,h,u,g,_){if(h.subarray&&d.subarray)d.set(h.subarray(u,u+g),_);else for(var i=0;i<g;i++)d[_+i]=h[u+i]},flattenChunks:function(d){var h,u,g,_,i,p;for(h=g=0,u=d.length;h<u;h++)g+=d[h].length;for(p=new Uint8Array(g),h=_=0,u=d.length;h<u;h++)i=d[h],p.set(i,_),_+=i.length;return p}},n={arraySet:function(d,h,u,g,_){for(var i=0;i<g;i++)d[_+i]=h[u+i]},flattenChunks:function(d){return[].concat.apply([],d)}};f.setTyped=function(d){d?(f.Buf8=Uint8Array,f.Buf16=Uint16Array,f.Buf32=Int32Array,f.assign(f,a)):(f.Buf8=Array,f.Buf16=Array,f.Buf32=Array,f.assign(f,n))},f.setTyped(s)},{}],42:[function(o,y,f){var s=o("./common"),a=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n=!1}for(var d=new s.Buf8(256),h=0;h<256;h++)d[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function u(g,_){if(_<65537&&(g.subarray&&n||!g.subarray&&a))return String.fromCharCode.apply(null,s.shrinkBuf(g,_));for(var i="",p=0;p<_;p++)i+=String.fromCharCode(g[p]);return i}d[254]=d[254]=1,f.string2buf=function(g){var _,i,p,t,l,c=g.length,b=0;for(t=0;t<c;t++)(64512&(i=g.charCodeAt(t)))==55296&&t+1<c&&(64512&(p=g.charCodeAt(t+1)))==56320&&(i=65536+(i-55296<<10)+(p-56320),t++),b+=i<128?1:i<2048?2:i<65536?3:4;for(_=new s.Buf8(b),t=l=0;l<b;t++)(64512&(i=g.charCodeAt(t)))==55296&&t+1<c&&(64512&(p=g.charCodeAt(t+1)))==56320&&(i=65536+(i-55296<<10)+(p-56320),t++),i<128?_[l++]=i:(i<2048?_[l++]=192|i>>>6:(i<65536?_[l++]=224|i>>>12:(_[l++]=240|i>>>18,_[l++]=128|i>>>12&63),_[l++]=128|i>>>6&63),_[l++]=128|63&i);return _},f.buf2binstring=function(g){return u(g,g.length)},f.binstring2buf=function(g){for(var _=new s.Buf8(g.length),i=0,p=_.length;i<p;i++)_[i]=g.charCodeAt(i);return _},f.buf2string=function(g,_){var i,p,t,l,c=_||g.length,b=new Array(2*c);for(i=p=0;i<c;)if((t=g[i++])<128)b[p++]=t;else if(4<(l=d[t]))b[p++]=65533,i+=l-1;else{for(t&=l===2?31:l===3?15:7;1<l&&i<c;)t=t<<6|63&g[i++],l--;1<l?b[p++]=65533:t<65536?b[p++]=t:(t-=65536,b[p++]=55296|t>>10&1023,b[p++]=56320|1023&t)}return u(b,p)},f.utf8border=function(g,_){var i;for((_=_||g.length)>g.length&&(_=g.length),i=_-1;0<=i&&(192&g[i])==128;)i--;return i<0||i===0?_:i+d[g[i]]>_?i:_}},{"./common":41}],43:[function(o,y,f){y.exports=function(s,a,n,d){for(var h=65535&s|0,u=s>>>16&65535|0,g=0;n!==0;){for(n-=g=2e3<n?2e3:n;u=u+(h=h+a[d++]|0)|0,--g;);h%=65521,u%=65521}return h|u<<16|0}},{}],44:[function(o,y,f){y.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(o,y,f){var s=(function(){for(var a,n=[],d=0;d<256;d++){a=d;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;n[d]=a}return n})();y.exports=function(a,n,d,h){var u=s,g=h+d;a^=-1;for(var _=h;_<g;_++)a=a>>>8^u[255&(a^n[_])];return-1^a}},{}],46:[function(o,y,f){var s,a=o("../utils/common"),n=o("./trees"),d=o("./adler32"),h=o("./crc32"),u=o("./messages"),g=0,_=4,i=0,p=-2,t=-1,l=4,c=2,b=8,S=9,A=286,j=30,O=19,I=2*A+1,U=15,L=3,$=258,J=$+L+1,k=42,F=113,r=1,B=2,te=3,H=4;function re(e,D){return e.msg=u[D],D}function W(e){return(e<<1)-(4<e?9:0)}function ee(e){for(var D=e.length;0<=--D;)e[D]=0}function R(e){var D=e.state,T=D.pending;T>e.avail_out&&(T=e.avail_out),T!==0&&(a.arraySet(e.output,D.pending_buf,D.pending_out,T,e.next_out),e.next_out+=T,D.pending_out+=T,e.total_out+=T,e.avail_out-=T,D.pending-=T,D.pending===0&&(D.pending_out=0))}function z(e,D){n._tr_flush_block(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,D),e.block_start=e.strstart,R(e.strm)}function V(e,D){e.pending_buf[e.pending++]=D}function Y(e,D){e.pending_buf[e.pending++]=D>>>8&255,e.pending_buf[e.pending++]=255&D}function K(e,D){var T,v,m=e.max_chain_length,C=e.strstart,M=e.prev_length,P=e.nice_match,E=e.strstart>e.w_size-J?e.strstart-(e.w_size-J):0,Z=e.window,q=e.w_mask,G=e.prev,X=e.strstart+$,se=Z[C+M-1],ne=Z[C+M];e.prev_length>=e.good_match&&(m>>=2),P>e.lookahead&&(P=e.lookahead);do if(Z[(T=D)+M]===ne&&Z[T+M-1]===se&&Z[T]===Z[C]&&Z[++T]===Z[C+1]){C+=2,T++;do;while(Z[++C]===Z[++T]&&Z[++C]===Z[++T]&&Z[++C]===Z[++T]&&Z[++C]===Z[++T]&&Z[++C]===Z[++T]&&Z[++C]===Z[++T]&&Z[++C]===Z[++T]&&Z[++C]===Z[++T]&&C<X);if(v=$-(X-C),C=X-$,M<v){if(e.match_start=D,P<=(M=v))break;se=Z[C+M-1],ne=Z[C+M]}}while((D=G[D&q])>E&&--m!=0);return M<=e.lookahead?M:e.lookahead}function oe(e){var D,T,v,m,C,M,P,E,Z,q,G=e.w_size;do{if(m=e.window_size-e.lookahead-e.strstart,e.strstart>=G+(G-J)){for(a.arraySet(e.window,e.window,G,G,0),e.match_start-=G,e.strstart-=G,e.block_start-=G,D=T=e.hash_size;v=e.head[--D],e.head[D]=G<=v?v-G:0,--T;);for(D=T=G;v=e.prev[--D],e.prev[D]=G<=v?v-G:0,--T;);m+=G}if(e.strm.avail_in===0)break;if(M=e.strm,P=e.window,E=e.strstart+e.lookahead,Z=m,q=void 0,q=M.avail_in,Z<q&&(q=Z),T=q===0?0:(M.avail_in-=q,a.arraySet(P,M.input,M.next_in,q,E),M.state.wrap===1?M.adler=d(M.adler,P,q,E):M.state.wrap===2&&(M.adler=h(M.adler,P,q,E)),M.next_in+=q,M.total_in+=q,q),e.lookahead+=T,e.lookahead+e.insert>=L)for(C=e.strstart-e.insert,e.ins_h=e.window[C],e.ins_h=(e.ins_h<<e.hash_shift^e.window[C+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[C+L-1])&e.hash_mask,e.prev[C&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=C,C++,e.insert--,!(e.lookahead+e.insert<L)););}while(e.lookahead<J&&e.strm.avail_in!==0)}function ue(e,D){for(var T,v;;){if(e.lookahead<J){if(oe(e),e.lookahead<J&&D===g)return r;if(e.lookahead===0)break}if(T=0,e.lookahead>=L&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+L-1])&e.hash_mask,T=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),T!==0&&e.strstart-T<=e.w_size-J&&(e.match_length=K(e,T)),e.match_length>=L)if(v=n._tr_tally(e,e.strstart-e.match_start,e.match_length-L),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=L){for(e.match_length--;e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+L-1])&e.hash_mask,T=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart,--e.match_length!=0;);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else v=n._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(v&&(z(e,!1),e.strm.avail_out===0))return r}return e.insert=e.strstart<L-1?e.strstart:L-1,D===_?(z(e,!0),e.strm.avail_out===0?te:H):e.last_lit&&(z(e,!1),e.strm.avail_out===0)?r:B}function ae(e,D){for(var T,v,m;;){if(e.lookahead<J){if(oe(e),e.lookahead<J&&D===g)return r;if(e.lookahead===0)break}if(T=0,e.lookahead>=L&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+L-1])&e.hash_mask,T=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=L-1,T!==0&&e.prev_length<e.max_lazy_match&&e.strstart-T<=e.w_size-J&&(e.match_length=K(e,T),e.match_length<=5&&(e.strategy===1||e.match_length===L&&4096<e.strstart-e.match_start)&&(e.match_length=L-1)),e.prev_length>=L&&e.match_length<=e.prev_length){for(m=e.strstart+e.lookahead-L,v=n._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-L),e.lookahead-=e.prev_length-1,e.prev_length-=2;++e.strstart<=m&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+L-1])&e.hash_mask,T=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),--e.prev_length!=0;);if(e.match_available=0,e.match_length=L-1,e.strstart++,v&&(z(e,!1),e.strm.avail_out===0))return r}else if(e.match_available){if((v=n._tr_tally(e,0,e.window[e.strstart-1]))&&z(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return r}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(v=n._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<L-1?e.strstart:L-1,D===_?(z(e,!0),e.strm.avail_out===0?te:H):e.last_lit&&(z(e,!1),e.strm.avail_out===0)?r:B}function ie(e,D,T,v,m){this.good_length=e,this.max_lazy=D,this.nice_length=T,this.max_chain=v,this.func=m}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*I),this.dyn_dtree=new a.Buf16(2*(2*j+1)),this.bl_tree=new a.Buf16(2*(2*O+1)),ee(this.dyn_ltree),ee(this.dyn_dtree),ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(U+1),this.heap=new a.Buf16(2*A+1),ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*A+1),ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function le(e){var D;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=c,(D=e.state).pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?k:F,e.adler=D.wrap===2?0:1,D.last_flush=g,n._tr_init(D),i):re(e,p)}function me(e){var D=le(e);return D===i&&(function(T){T.window_size=2*T.w_size,ee(T.head),T.max_lazy_match=s[T.level].max_lazy,T.good_match=s[T.level].good_length,T.nice_match=s[T.level].nice_length,T.max_chain_length=s[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=L-1,T.match_available=0,T.ins_h=0})(e.state),D}function pe(e,D,T,v,m,C){if(!e)return p;var M=1;if(D===t&&(D=6),v<0?(M=0,v=-v):15<v&&(M=2,v-=16),m<1||S<m||T!==b||v<8||15<v||D<0||9<D||C<0||l<C)return re(e,p);v===8&&(v=9);var P=new ce;return(e.state=P).strm=e,P.wrap=M,P.gzhead=null,P.w_bits=v,P.w_size=1<<P.w_bits,P.w_mask=P.w_size-1,P.hash_bits=m+7,P.hash_size=1<<P.hash_bits,P.hash_mask=P.hash_size-1,P.hash_shift=~~((P.hash_bits+L-1)/L),P.window=new a.Buf8(2*P.w_size),P.head=new a.Buf16(P.hash_size),P.prev=new a.Buf16(P.w_size),P.lit_bufsize=1<<m+6,P.pending_buf_size=4*P.lit_bufsize,P.pending_buf=new a.Buf8(P.pending_buf_size),P.d_buf=1*P.lit_bufsize,P.l_buf=3*P.lit_bufsize,P.level=D,P.strategy=C,P.method=T,me(e)}s=[new ie(0,0,0,0,function(e,D){var T=65535;for(T>e.pending_buf_size-5&&(T=e.pending_buf_size-5);;){if(e.lookahead<=1){if(oe(e),e.lookahead===0&&D===g)return r;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var v=e.block_start+T;if((e.strstart===0||e.strstart>=v)&&(e.lookahead=e.strstart-v,e.strstart=v,z(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-J&&(z(e,!1),e.strm.avail_out===0))return r}return e.insert=0,D===_?(z(e,!0),e.strm.avail_out===0?te:H):(e.strstart>e.block_start&&(z(e,!1),e.strm.avail_out),r)}),new ie(4,4,8,4,ue),new ie(4,5,16,8,ue),new ie(4,6,32,32,ue),new ie(4,4,16,16,ae),new ie(8,16,32,32,ae),new ie(8,16,128,128,ae),new ie(8,32,128,256,ae),new ie(32,128,258,1024,ae),new ie(32,258,258,4096,ae)],f.deflateInit=function(e,D){return pe(e,D,b,15,8,0)},f.deflateInit2=pe,f.deflateReset=me,f.deflateResetKeep=le,f.deflateSetHeader=function(e,D){return e&&e.state?e.state.wrap!==2?p:(e.state.gzhead=D,i):p},f.deflate=function(e,D){var T,v,m,C;if(!e||!e.state||5<D||D<0)return e?re(e,p):p;if(v=e.state,!e.output||!e.input&&e.avail_in!==0||v.status===666&&D!==_)return re(e,e.avail_out===0?-5:p);if(v.strm=e,T=v.last_flush,v.last_flush=D,v.status===k)if(v.wrap===2)e.adler=0,V(v,31),V(v,139),V(v,8),v.gzhead?(V(v,(v.gzhead.text?1:0)+(v.gzhead.hcrc?2:0)+(v.gzhead.extra?4:0)+(v.gzhead.name?8:0)+(v.gzhead.comment?16:0)),V(v,255&v.gzhead.time),V(v,v.gzhead.time>>8&255),V(v,v.gzhead.time>>16&255),V(v,v.gzhead.time>>24&255),V(v,v.level===9?2:2<=v.strategy||v.level<2?4:0),V(v,255&v.gzhead.os),v.gzhead.extra&&v.gzhead.extra.length&&(V(v,255&v.gzhead.extra.length),V(v,v.gzhead.extra.length>>8&255)),v.gzhead.hcrc&&(e.adler=h(e.adler,v.pending_buf,v.pending,0)),v.gzindex=0,v.status=69):(V(v,0),V(v,0),V(v,0),V(v,0),V(v,0),V(v,v.level===9?2:2<=v.strategy||v.level<2?4:0),V(v,3),v.status=F);else{var M=b+(v.w_bits-8<<4)<<8;M|=(2<=v.strategy||v.level<2?0:v.level<6?1:v.level===6?2:3)<<6,v.strstart!==0&&(M|=32),M+=31-M%31,v.status=F,Y(v,M),v.strstart!==0&&(Y(v,e.adler>>>16),Y(v,65535&e.adler)),e.adler=1}if(v.status===69)if(v.gzhead.extra){for(m=v.pending;v.gzindex<(65535&v.gzhead.extra.length)&&(v.pending!==v.pending_buf_size||(v.gzhead.hcrc&&v.pending>m&&(e.adler=h(e.adler,v.pending_buf,v.pending-m,m)),R(e),m=v.pending,v.pending!==v.pending_buf_size));)V(v,255&v.gzhead.extra[v.gzindex]),v.gzindex++;v.gzhead.hcrc&&v.pending>m&&(e.adler=h(e.adler,v.pending_buf,v.pending-m,m)),v.gzindex===v.gzhead.extra.length&&(v.gzindex=0,v.status=73)}else v.status=73;if(v.status===73)if(v.gzhead.name){m=v.pending;do{if(v.pending===v.pending_buf_size&&(v.gzhead.hcrc&&v.pending>m&&(e.adler=h(e.adler,v.pending_buf,v.pending-m,m)),R(e),m=v.pending,v.pending===v.pending_buf_size)){C=1;break}C=v.gzindex<v.gzhead.name.length?255&v.gzhead.name.charCodeAt(v.gzindex++):0,V(v,C)}while(C!==0);v.gzhead.hcrc&&v.pending>m&&(e.adler=h(e.adler,v.pending_buf,v.pending-m,m)),C===0&&(v.gzindex=0,v.status=91)}else v.status=91;if(v.status===91)if(v.gzhead.comment){m=v.pending;do{if(v.pending===v.pending_buf_size&&(v.gzhead.hcrc&&v.pending>m&&(e.adler=h(e.adler,v.pending_buf,v.pending-m,m)),R(e),m=v.pending,v.pending===v.pending_buf_size)){C=1;break}C=v.gzindex<v.gzhead.comment.length?255&v.gzhead.comment.charCodeAt(v.gzindex++):0,V(v,C)}while(C!==0);v.gzhead.hcrc&&v.pending>m&&(e.adler=h(e.adler,v.pending_buf,v.pending-m,m)),C===0&&(v.status=103)}else v.status=103;if(v.status===103&&(v.gzhead.hcrc?(v.pending+2>v.pending_buf_size&&R(e),v.pending+2<=v.pending_buf_size&&(V(v,255&e.adler),V(v,e.adler>>8&255),e.adler=0,v.status=F)):v.status=F),v.pending!==0){if(R(e),e.avail_out===0)return v.last_flush=-1,i}else if(e.avail_in===0&&W(D)<=W(T)&&D!==_)return re(e,-5);if(v.status===666&&e.avail_in!==0)return re(e,-5);if(e.avail_in!==0||v.lookahead!==0||D!==g&&v.status!==666){var P=v.strategy===2?(function(E,Z){for(var q;;){if(E.lookahead===0&&(oe(E),E.lookahead===0)){if(Z===g)return r;break}if(E.match_length=0,q=n._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++,q&&(z(E,!1),E.strm.avail_out===0))return r}return E.insert=0,Z===_?(z(E,!0),E.strm.avail_out===0?te:H):E.last_lit&&(z(E,!1),E.strm.avail_out===0)?r:B})(v,D):v.strategy===3?(function(E,Z){for(var q,G,X,se,ne=E.window;;){if(E.lookahead<=$){if(oe(E),E.lookahead<=$&&Z===g)return r;if(E.lookahead===0)break}if(E.match_length=0,E.lookahead>=L&&0<E.strstart&&(G=ne[X=E.strstart-1])===ne[++X]&&G===ne[++X]&&G===ne[++X]){se=E.strstart+$;do;while(G===ne[++X]&&G===ne[++X]&&G===ne[++X]&&G===ne[++X]&&G===ne[++X]&&G===ne[++X]&&G===ne[++X]&&G===ne[++X]&&X<se);E.match_length=$-(se-X),E.match_length>E.lookahead&&(E.match_length=E.lookahead)}if(E.match_length>=L?(q=n._tr_tally(E,1,E.match_length-L),E.lookahead-=E.match_length,E.strstart+=E.match_length,E.match_length=0):(q=n._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++),q&&(z(E,!1),E.strm.avail_out===0))return r}return E.insert=0,Z===_?(z(E,!0),E.strm.avail_out===0?te:H):E.last_lit&&(z(E,!1),E.strm.avail_out===0)?r:B})(v,D):s[v.level].func(v,D);if(P!==te&&P!==H||(v.status=666),P===r||P===te)return e.avail_out===0&&(v.last_flush=-1),i;if(P===B&&(D===1?n._tr_align(v):D!==5&&(n._tr_stored_block(v,0,0,!1),D===3&&(ee(v.head),v.lookahead===0&&(v.strstart=0,v.block_start=0,v.insert=0))),R(e),e.avail_out===0))return v.last_flush=-1,i}return D!==_?i:v.wrap<=0?1:(v.wrap===2?(V(v,255&e.adler),V(v,e.adler>>8&255),V(v,e.adler>>16&255),V(v,e.adler>>24&255),V(v,255&e.total_in),V(v,e.total_in>>8&255),V(v,e.total_in>>16&255),V(v,e.total_in>>24&255)):(Y(v,e.adler>>>16),Y(v,65535&e.adler)),R(e),0<v.wrap&&(v.wrap=-v.wrap),v.pending!==0?i:1)},f.deflateEnd=function(e){var D;return e&&e.state?(D=e.state.status)!==k&&D!==69&&D!==73&&D!==91&&D!==103&&D!==F&&D!==666?re(e,p):(e.state=null,D===F?re(e,-3):i):p},f.deflateSetDictionary=function(e,D){var T,v,m,C,M,P,E,Z,q=D.length;if(!e||!e.state||(C=(T=e.state).wrap)===2||C===1&&T.status!==k||T.lookahead)return p;for(C===1&&(e.adler=d(e.adler,D,q,0)),T.wrap=0,q>=T.w_size&&(C===0&&(ee(T.head),T.strstart=0,T.block_start=0,T.insert=0),Z=new a.Buf8(T.w_size),a.arraySet(Z,D,q-T.w_size,T.w_size,0),D=Z,q=T.w_size),M=e.avail_in,P=e.next_in,E=e.input,e.avail_in=q,e.next_in=0,e.input=D,oe(T);T.lookahead>=L;){for(v=T.strstart,m=T.lookahead-(L-1);T.ins_h=(T.ins_h<<T.hash_shift^T.window[v+L-1])&T.hash_mask,T.prev[v&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=v,v++,--m;);T.strstart=v,T.lookahead=L-1,oe(T)}return T.strstart+=T.lookahead,T.block_start=T.strstart,T.insert=T.lookahead,T.lookahead=0,T.match_length=T.prev_length=L-1,T.match_available=0,e.next_in=P,e.input=E,e.avail_in=M,T.wrap=C,i},f.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(o,y,f){y.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(o,y,f){y.exports=function(s,a){var n,d,h,u,g,_,i,p,t,l,c,b,S,A,j,O,I,U,L,$,J,k,F,r,B;n=s.state,d=s.next_in,r=s.input,h=d+(s.avail_in-5),u=s.next_out,B=s.output,g=u-(a-s.avail_out),_=u+(s.avail_out-257),i=n.dmax,p=n.wsize,t=n.whave,l=n.wnext,c=n.window,b=n.hold,S=n.bits,A=n.lencode,j=n.distcode,O=(1<<n.lenbits)-1,I=(1<<n.distbits)-1;e:do{S<15&&(b+=r[d++]<<S,S+=8,b+=r[d++]<<S,S+=8),U=A[b&O];t:for(;;){if(b>>>=L=U>>>24,S-=L,(L=U>>>16&255)===0)B[u++]=65535&U;else{if(!(16&L)){if((64&L)==0){U=A[(65535&U)+(b&(1<<L)-1)];continue t}if(32&L){n.mode=12;break e}s.msg="invalid literal/length code",n.mode=30;break e}$=65535&U,(L&=15)&&(S<L&&(b+=r[d++]<<S,S+=8),$+=b&(1<<L)-1,b>>>=L,S-=L),S<15&&(b+=r[d++]<<S,S+=8,b+=r[d++]<<S,S+=8),U=j[b&I];r:for(;;){if(b>>>=L=U>>>24,S-=L,!(16&(L=U>>>16&255))){if((64&L)==0){U=j[(65535&U)+(b&(1<<L)-1)];continue r}s.msg="invalid distance code",n.mode=30;break e}if(J=65535&U,S<(L&=15)&&(b+=r[d++]<<S,(S+=8)<L&&(b+=r[d++]<<S,S+=8)),i<(J+=b&(1<<L)-1)){s.msg="invalid distance too far back",n.mode=30;break e}if(b>>>=L,S-=L,(L=u-g)<J){if(t<(L=J-L)&&n.sane){s.msg="invalid distance too far back",n.mode=30;break e}if(F=c,(k=0)===l){if(k+=p-L,L<$){for($-=L;B[u++]=c[k++],--L;);k=u-J,F=B}}else if(l<L){if(k+=p+l-L,(L-=l)<$){for($-=L;B[u++]=c[k++],--L;);if(k=0,l<$){for($-=L=l;B[u++]=c[k++],--L;);k=u-J,F=B}}}else if(k+=l-L,L<$){for($-=L;B[u++]=c[k++],--L;);k=u-J,F=B}for(;2<$;)B[u++]=F[k++],B[u++]=F[k++],B[u++]=F[k++],$-=3;$&&(B[u++]=F[k++],1<$&&(B[u++]=F[k++]))}else{for(k=u-J;B[u++]=B[k++],B[u++]=B[k++],B[u++]=B[k++],2<($-=3););$&&(B[u++]=B[k++],1<$&&(B[u++]=B[k++]))}break}}break}}while(d<h&&u<_);d-=$=S>>3,b&=(1<<(S-=$<<3))-1,s.next_in=d,s.next_out=u,s.avail_in=d<h?h-d+5:5-(d-h),s.avail_out=u<_?_-u+257:257-(u-_),n.hold=b,n.bits=S}},{}],49:[function(o,y,f){var s=o("../utils/common"),a=o("./adler32"),n=o("./crc32"),d=o("./inffast"),h=o("./inftrees"),u=1,g=2,_=0,i=-2,p=1,t=852,l=592;function c(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(k){var F;return k&&k.state?(F=k.state,k.total_in=k.total_out=F.total=0,k.msg="",F.wrap&&(k.adler=1&F.wrap),F.mode=p,F.last=0,F.havedict=0,F.dmax=32768,F.head=null,F.hold=0,F.bits=0,F.lencode=F.lendyn=new s.Buf32(t),F.distcode=F.distdyn=new s.Buf32(l),F.sane=1,F.back=-1,_):i}function A(k){var F;return k&&k.state?((F=k.state).wsize=0,F.whave=0,F.wnext=0,S(k)):i}function j(k,F){var r,B;return k&&k.state?(B=k.state,F<0?(r=0,F=-F):(r=1+(F>>4),F<48&&(F&=15)),F&&(F<8||15<F)?i:(B.window!==null&&B.wbits!==F&&(B.window=null),B.wrap=r,B.wbits=F,A(k))):i}function O(k,F){var r,B;return k?(B=new b,(k.state=B).window=null,(r=j(k,F))!==_&&(k.state=null),r):i}var I,U,L=!0;function $(k){if(L){var F;for(I=new s.Buf32(512),U=new s.Buf32(32),F=0;F<144;)k.lens[F++]=8;for(;F<256;)k.lens[F++]=9;for(;F<280;)k.lens[F++]=7;for(;F<288;)k.lens[F++]=8;for(h(u,k.lens,0,288,I,0,k.work,{bits:9}),F=0;F<32;)k.lens[F++]=5;h(g,k.lens,0,32,U,0,k.work,{bits:5}),L=!1}k.lencode=I,k.lenbits=9,k.distcode=U,k.distbits=5}function J(k,F,r,B){var te,H=k.state;return H.window===null&&(H.wsize=1<<H.wbits,H.wnext=0,H.whave=0,H.window=new s.Buf8(H.wsize)),B>=H.wsize?(s.arraySet(H.window,F,r-H.wsize,H.wsize,0),H.wnext=0,H.whave=H.wsize):(B<(te=H.wsize-H.wnext)&&(te=B),s.arraySet(H.window,F,r-B,te,H.wnext),(B-=te)?(s.arraySet(H.window,F,r-B,B,0),H.wnext=B,H.whave=H.wsize):(H.wnext+=te,H.wnext===H.wsize&&(H.wnext=0),H.whave<H.wsize&&(H.whave+=te))),0}f.inflateReset=A,f.inflateReset2=j,f.inflateResetKeep=S,f.inflateInit=function(k){return O(k,15)},f.inflateInit2=O,f.inflate=function(k,F){var r,B,te,H,re,W,ee,R,z,V,Y,K,oe,ue,ae,ie,ce,le,me,pe,e,D,T,v,m=0,C=new s.Buf8(4),M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return i;(r=k.state).mode===12&&(r.mode=13),re=k.next_out,te=k.output,ee=k.avail_out,H=k.next_in,B=k.input,W=k.avail_in,R=r.hold,z=r.bits,V=W,Y=ee,D=_;e:for(;;)switch(r.mode){case p:if(r.wrap===0){r.mode=13;break}for(;z<16;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if(2&r.wrap&&R===35615){C[r.check=0]=255&R,C[1]=R>>>8&255,r.check=n(r.check,C,2,0),z=R=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&R)<<8)+(R>>8))%31){k.msg="incorrect header check",r.mode=30;break}if((15&R)!=8){k.msg="unknown compression method",r.mode=30;break}if(z-=4,e=8+(15&(R>>>=4)),r.wbits===0)r.wbits=e;else if(e>r.wbits){k.msg="invalid window size",r.mode=30;break}r.dmax=1<<e,k.adler=r.check=1,r.mode=512&R?10:12,z=R=0;break;case 2:for(;z<16;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if(r.flags=R,(255&r.flags)!=8){k.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){k.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=R>>8&1),512&r.flags&&(C[0]=255&R,C[1]=R>>>8&255,r.check=n(r.check,C,2,0)),z=R=0,r.mode=3;case 3:for(;z<32;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}r.head&&(r.head.time=R),512&r.flags&&(C[0]=255&R,C[1]=R>>>8&255,C[2]=R>>>16&255,C[3]=R>>>24&255,r.check=n(r.check,C,4,0)),z=R=0,r.mode=4;case 4:for(;z<16;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}r.head&&(r.head.xflags=255&R,r.head.os=R>>8),512&r.flags&&(C[0]=255&R,C[1]=R>>>8&255,r.check=n(r.check,C,2,0)),z=R=0,r.mode=5;case 5:if(1024&r.flags){for(;z<16;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}r.length=R,r.head&&(r.head.extra_len=R),512&r.flags&&(C[0]=255&R,C[1]=R>>>8&255,r.check=n(r.check,C,2,0)),z=R=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(W<(K=r.length)&&(K=W),K&&(r.head&&(e=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),s.arraySet(r.head.extra,B,H,K,e)),512&r.flags&&(r.check=n(r.check,B,K,H)),W-=K,H+=K,r.length-=K),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(W===0)break e;for(K=0;e=B[H+K++],r.head&&e&&r.length<65536&&(r.head.name+=String.fromCharCode(e)),e&&K<W;);if(512&r.flags&&(r.check=n(r.check,B,K,H)),W-=K,H+=K,e)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(W===0)break e;for(K=0;e=B[H+K++],r.head&&e&&r.length<65536&&(r.head.comment+=String.fromCharCode(e)),e&&K<W;);if(512&r.flags&&(r.check=n(r.check,B,K,H)),W-=K,H+=K,e)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;z<16;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if(R!==(65535&r.check)){k.msg="header crc mismatch",r.mode=30;break}z=R=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),k.adler=r.check=0,r.mode=12;break;case 10:for(;z<32;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}k.adler=r.check=c(R),z=R=0,r.mode=11;case 11:if(r.havedict===0)return k.next_out=re,k.avail_out=ee,k.next_in=H,k.avail_in=W,r.hold=R,r.bits=z,2;k.adler=r.check=1,r.mode=12;case 12:if(F===5||F===6)break e;case 13:if(r.last){R>>>=7&z,z-=7&z,r.mode=27;break}for(;z<3;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}switch(r.last=1&R,z-=1,3&(R>>>=1)){case 0:r.mode=14;break;case 1:if($(r),r.mode=20,F!==6)break;R>>>=2,z-=2;break e;case 2:r.mode=17;break;case 3:k.msg="invalid block type",r.mode=30}R>>>=2,z-=2;break;case 14:for(R>>>=7&z,z-=7&z;z<32;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if((65535&R)!=(R>>>16^65535)){k.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&R,z=R=0,r.mode=15,F===6)break e;case 15:r.mode=16;case 16:if(K=r.length){if(W<K&&(K=W),ee<K&&(K=ee),K===0)break e;s.arraySet(te,B,H,K,re),W-=K,H+=K,ee-=K,re+=K,r.length-=K;break}r.mode=12;break;case 17:for(;z<14;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if(r.nlen=257+(31&R),R>>>=5,z-=5,r.ndist=1+(31&R),R>>>=5,z-=5,r.ncode=4+(15&R),R>>>=4,z-=4,286<r.nlen||30<r.ndist){k.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;z<3;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}r.lens[M[r.have++]]=7&R,R>>>=3,z-=3}for(;r.have<19;)r.lens[M[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,T={bits:r.lenbits},D=h(0,r.lens,0,19,r.lencode,0,r.work,T),r.lenbits=T.bits,D){k.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;ie=(m=r.lencode[R&(1<<r.lenbits)-1])>>>16&255,ce=65535&m,!((ae=m>>>24)<=z);){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if(ce<16)R>>>=ae,z-=ae,r.lens[r.have++]=ce;else{if(ce===16){for(v=ae+2;z<v;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if(R>>>=ae,z-=ae,r.have===0){k.msg="invalid bit length repeat",r.mode=30;break}e=r.lens[r.have-1],K=3+(3&R),R>>>=2,z-=2}else if(ce===17){for(v=ae+3;z<v;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}z-=ae,e=0,K=3+(7&(R>>>=ae)),R>>>=3,z-=3}else{for(v=ae+7;z<v;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}z-=ae,e=0,K=11+(127&(R>>>=ae)),R>>>=7,z-=7}if(r.have+K>r.nlen+r.ndist){k.msg="invalid bit length repeat",r.mode=30;break}for(;K--;)r.lens[r.have++]=e}}if(r.mode===30)break;if(r.lens[256]===0){k.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,T={bits:r.lenbits},D=h(u,r.lens,0,r.nlen,r.lencode,0,r.work,T),r.lenbits=T.bits,D){k.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,T={bits:r.distbits},D=h(g,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,T),r.distbits=T.bits,D){k.msg="invalid distances set",r.mode=30;break}if(r.mode=20,F===6)break e;case 20:r.mode=21;case 21:if(6<=W&&258<=ee){k.next_out=re,k.avail_out=ee,k.next_in=H,k.avail_in=W,r.hold=R,r.bits=z,d(k,Y),re=k.next_out,te=k.output,ee=k.avail_out,H=k.next_in,B=k.input,W=k.avail_in,R=r.hold,z=r.bits,r.mode===12&&(r.back=-1);break}for(r.back=0;ie=(m=r.lencode[R&(1<<r.lenbits)-1])>>>16&255,ce=65535&m,!((ae=m>>>24)<=z);){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if(ie&&(240&ie)==0){for(le=ae,me=ie,pe=ce;ie=(m=r.lencode[pe+((R&(1<<le+me)-1)>>le)])>>>16&255,ce=65535&m,!(le+(ae=m>>>24)<=z);){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}R>>>=le,z-=le,r.back+=le}if(R>>>=ae,z-=ae,r.back+=ae,r.length=ce,ie===0){r.mode=26;break}if(32&ie){r.back=-1,r.mode=12;break}if(64&ie){k.msg="invalid literal/length code",r.mode=30;break}r.extra=15&ie,r.mode=22;case 22:if(r.extra){for(v=r.extra;z<v;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}r.length+=R&(1<<r.extra)-1,R>>>=r.extra,z-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;ie=(m=r.distcode[R&(1<<r.distbits)-1])>>>16&255,ce=65535&m,!((ae=m>>>24)<=z);){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if((240&ie)==0){for(le=ae,me=ie,pe=ce;ie=(m=r.distcode[pe+((R&(1<<le+me)-1)>>le)])>>>16&255,ce=65535&m,!(le+(ae=m>>>24)<=z);){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}R>>>=le,z-=le,r.back+=le}if(R>>>=ae,z-=ae,r.back+=ae,64&ie){k.msg="invalid distance code",r.mode=30;break}r.offset=ce,r.extra=15&ie,r.mode=24;case 24:if(r.extra){for(v=r.extra;z<v;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}r.offset+=R&(1<<r.extra)-1,R>>>=r.extra,z-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){k.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(ee===0)break e;if(K=Y-ee,r.offset>K){if((K=r.offset-K)>r.whave&&r.sane){k.msg="invalid distance too far back",r.mode=30;break}oe=K>r.wnext?(K-=r.wnext,r.wsize-K):r.wnext-K,K>r.length&&(K=r.length),ue=r.window}else ue=te,oe=re-r.offset,K=r.length;for(ee<K&&(K=ee),ee-=K,r.length-=K;te[re++]=ue[oe++],--K;);r.length===0&&(r.mode=21);break;case 26:if(ee===0)break e;te[re++]=r.length,ee--,r.mode=21;break;case 27:if(r.wrap){for(;z<32;){if(W===0)break e;W--,R|=B[H++]<<z,z+=8}if(Y-=ee,k.total_out+=Y,r.total+=Y,Y&&(k.adler=r.check=r.flags?n(r.check,te,Y,re-Y):a(r.check,te,Y,re-Y)),Y=ee,(r.flags?R:c(R))!==r.check){k.msg="incorrect data check",r.mode=30;break}z=R=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;z<32;){if(W===0)break e;W--,R+=B[H++]<<z,z+=8}if(R!==(4294967295&r.total)){k.msg="incorrect length check",r.mode=30;break}z=R=0}r.mode=29;case 29:D=1;break e;case 30:D=-3;break e;case 31:return-4;case 32:default:return i}return k.next_out=re,k.avail_out=ee,k.next_in=H,k.avail_in=W,r.hold=R,r.bits=z,(r.wsize||Y!==k.avail_out&&r.mode<30&&(r.mode<27||F!==4))&&J(k,k.output,k.next_out,Y-k.avail_out)?(r.mode=31,-4):(V-=k.avail_in,Y-=k.avail_out,k.total_in+=V,k.total_out+=Y,r.total+=Y,r.wrap&&Y&&(k.adler=r.check=r.flags?n(r.check,te,Y,k.next_out-Y):a(r.check,te,Y,k.next_out-Y)),k.data_type=r.bits+(r.last?64:0)+(r.mode===12?128:0)+(r.mode===20||r.mode===15?256:0),(V==0&&Y===0||F===4)&&D===_&&(D=-5),D)},f.inflateEnd=function(k){if(!k||!k.state)return i;var F=k.state;return F.window&&(F.window=null),k.state=null,_},f.inflateGetHeader=function(k,F){var r;return k&&k.state?(2&(r=k.state).wrap)==0?i:((r.head=F).done=!1,_):i},f.inflateSetDictionary=function(k,F){var r,B=F.length;return k&&k.state?(r=k.state).wrap!==0&&r.mode!==11?i:r.mode===11&&a(1,F,B,0)!==r.check?-3:J(k,F,B,B)?(r.mode=31,-4):(r.havedict=1,_):i},f.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(o,y,f){var s=o("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];y.exports=function(u,g,_,i,p,t,l,c){var b,S,A,j,O,I,U,L,$,J=c.bits,k=0,F=0,r=0,B=0,te=0,H=0,re=0,W=0,ee=0,R=0,z=null,V=0,Y=new s.Buf16(16),K=new s.Buf16(16),oe=null,ue=0;for(k=0;k<=15;k++)Y[k]=0;for(F=0;F<i;F++)Y[g[_+F]]++;for(te=J,B=15;1<=B&&Y[B]===0;B--);if(B<te&&(te=B),B===0)return p[t++]=20971520,p[t++]=20971520,c.bits=1,0;for(r=1;r<B&&Y[r]===0;r++);for(te<r&&(te=r),k=W=1;k<=15;k++)if(W<<=1,(W-=Y[k])<0)return-1;if(0<W&&(u===0||B!==1))return-1;for(K[1]=0,k=1;k<15;k++)K[k+1]=K[k]+Y[k];for(F=0;F<i;F++)g[_+F]!==0&&(l[K[g[_+F]]++]=F);if(I=u===0?(z=oe=l,19):u===1?(z=a,V-=257,oe=n,ue-=257,256):(z=d,oe=h,-1),k=r,O=t,re=F=R=0,A=-1,j=(ee=1<<(H=te))-1,u===1&&852<ee||u===2&&592<ee)return 1;for(;;){for(U=k-re,$=l[F]<I?(L=0,l[F]):l[F]>I?(L=oe[ue+l[F]],z[V+l[F]]):(L=96,0),b=1<<k-re,r=S=1<<H;p[O+(R>>re)+(S-=b)]=U<<24|L<<16|$|0,S!==0;);for(b=1<<k-1;R&b;)b>>=1;if(b!==0?(R&=b-1,R+=b):R=0,F++,--Y[k]==0){if(k===B)break;k=g[_+l[F]]}if(te<k&&(R&j)!==A){for(re===0&&(re=te),O+=r,W=1<<(H=k-re);H+re<B&&!((W-=Y[H+re])<=0);)H++,W<<=1;if(ee+=1<<H,u===1&&852<ee||u===2&&592<ee)return 1;p[A=R&j]=te<<24|H<<16|O-t|0}}return R!==0&&(p[O+R]=k-re<<24|64<<16|0),c.bits=te,0}},{"../utils/common":41}],51:[function(o,y,f){y.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(o,y,f){var s=o("../utils/common"),a=0,n=1;function d(m){for(var C=m.length;0<=--C;)m[C]=0}var h=0,u=29,g=256,_=g+1+u,i=30,p=19,t=2*_+1,l=15,c=16,b=7,S=256,A=16,j=17,O=18,I=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],$=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(_+2));d(J);var k=new Array(2*i);d(k);var F=new Array(512);d(F);var r=new Array(256);d(r);var B=new Array(u);d(B);var te,H,re,W=new Array(i);function ee(m,C,M,P,E){this.static_tree=m,this.extra_bits=C,this.extra_base=M,this.elems=P,this.max_length=E,this.has_stree=m&&m.length}function R(m,C){this.dyn_tree=m,this.max_code=0,this.stat_desc=C}function z(m){return m<256?F[m]:F[256+(m>>>7)]}function V(m,C){m.pending_buf[m.pending++]=255&C,m.pending_buf[m.pending++]=C>>>8&255}function Y(m,C,M){m.bi_valid>c-M?(m.bi_buf|=C<<m.bi_valid&65535,V(m,m.bi_buf),m.bi_buf=C>>c-m.bi_valid,m.bi_valid+=M-c):(m.bi_buf|=C<<m.bi_valid&65535,m.bi_valid+=M)}function K(m,C,M){Y(m,M[2*C],M[2*C+1])}function oe(m,C){for(var M=0;M|=1&m,m>>>=1,M<<=1,0<--C;);return M>>>1}function ue(m,C,M){var P,E,Z=new Array(l+1),q=0;for(P=1;P<=l;P++)Z[P]=q=q+M[P-1]<<1;for(E=0;E<=C;E++){var G=m[2*E+1];G!==0&&(m[2*E]=oe(Z[G]++,G))}}function ae(m){var C;for(C=0;C<_;C++)m.dyn_ltree[2*C]=0;for(C=0;C<i;C++)m.dyn_dtree[2*C]=0;for(C=0;C<p;C++)m.bl_tree[2*C]=0;m.dyn_ltree[2*S]=1,m.opt_len=m.static_len=0,m.last_lit=m.matches=0}function ie(m){8<m.bi_valid?V(m,m.bi_buf):0<m.bi_valid&&(m.pending_buf[m.pending++]=m.bi_buf),m.bi_buf=0,m.bi_valid=0}function ce(m,C,M,P){var E=2*C,Z=2*M;return m[E]<m[Z]||m[E]===m[Z]&&P[C]<=P[M]}function le(m,C,M){for(var P=m.heap[M],E=M<<1;E<=m.heap_len&&(E<m.heap_len&&ce(C,m.heap[E+1],m.heap[E],m.depth)&&E++,!ce(C,P,m.heap[E],m.depth));)m.heap[M]=m.heap[E],M=E,E<<=1;m.heap[M]=P}function me(m,C,M){var P,E,Z,q,G=0;if(m.last_lit!==0)for(;P=m.pending_buf[m.d_buf+2*G]<<8|m.pending_buf[m.d_buf+2*G+1],E=m.pending_buf[m.l_buf+G],G++,P===0?K(m,E,C):(K(m,(Z=r[E])+g+1,C),(q=I[Z])!==0&&Y(m,E-=B[Z],q),K(m,Z=z(--P),M),(q=U[Z])!==0&&Y(m,P-=W[Z],q)),G<m.last_lit;);K(m,S,C)}function pe(m,C){var M,P,E,Z=C.dyn_tree,q=C.stat_desc.static_tree,G=C.stat_desc.has_stree,X=C.stat_desc.elems,se=-1;for(m.heap_len=0,m.heap_max=t,M=0;M<X;M++)Z[2*M]!==0?(m.heap[++m.heap_len]=se=M,m.depth[M]=0):Z[2*M+1]=0;for(;m.heap_len<2;)Z[2*(E=m.heap[++m.heap_len]=se<2?++se:0)]=1,m.depth[E]=0,m.opt_len--,G&&(m.static_len-=q[2*E+1]);for(C.max_code=se,M=m.heap_len>>1;1<=M;M--)le(m,Z,M);for(E=X;M=m.heap[1],m.heap[1]=m.heap[m.heap_len--],le(m,Z,1),P=m.heap[1],m.heap[--m.heap_max]=M,m.heap[--m.heap_max]=P,Z[2*E]=Z[2*M]+Z[2*P],m.depth[E]=(m.depth[M]>=m.depth[P]?m.depth[M]:m.depth[P])+1,Z[2*M+1]=Z[2*P+1]=E,m.heap[1]=E++,le(m,Z,1),2<=m.heap_len;);m.heap[--m.heap_max]=m.heap[1],(function(ne,he){var ke,ge,we,de,Ce,Re,be=he.dyn_tree,Me=he.max_code,et=he.stat_desc.static_tree,tt=he.stat_desc.has_stree,rt=he.stat_desc.extra_bits,Ue=he.stat_desc.extra_base,Se=he.stat_desc.max_length,je=0;for(de=0;de<=l;de++)ne.bl_count[de]=0;for(be[2*ne.heap[ne.heap_max]+1]=0,ke=ne.heap_max+1;ke<t;ke++)Se<(de=be[2*be[2*(ge=ne.heap[ke])+1]+1]+1)&&(de=Se,je++),be[2*ge+1]=de,Me<ge||(ne.bl_count[de]++,Ce=0,Ue<=ge&&(Ce=rt[ge-Ue]),Re=be[2*ge],ne.opt_len+=Re*(de+Ce),tt&&(ne.static_len+=Re*(et[2*ge+1]+Ce)));if(je!==0){do{for(de=Se-1;ne.bl_count[de]===0;)de--;ne.bl_count[de]--,ne.bl_count[de+1]+=2,ne.bl_count[Se]--,je-=2}while(0<je);for(de=Se;de!==0;de--)for(ge=ne.bl_count[de];ge!==0;)Me<(we=ne.heap[--ke])||(be[2*we+1]!==de&&(ne.opt_len+=(de-be[2*we+1])*be[2*we],be[2*we+1]=de),ge--)}})(m,C),ue(Z,se,m.bl_count)}function e(m,C,M){var P,E,Z=-1,q=C[1],G=0,X=7,se=4;for(q===0&&(X=138,se=3),C[2*(M+1)+1]=65535,P=0;P<=M;P++)E=q,q=C[2*(P+1)+1],++G<X&&E===q||(G<se?m.bl_tree[2*E]+=G:E!==0?(E!==Z&&m.bl_tree[2*E]++,m.bl_tree[2*A]++):G<=10?m.bl_tree[2*j]++:m.bl_tree[2*O]++,Z=E,se=(G=0)===q?(X=138,3):E===q?(X=6,3):(X=7,4))}function D(m,C,M){var P,E,Z=-1,q=C[1],G=0,X=7,se=4;for(q===0&&(X=138,se=3),P=0;P<=M;P++)if(E=q,q=C[2*(P+1)+1],!(++G<X&&E===q)){if(G<se)for(;K(m,E,m.bl_tree),--G!=0;);else E!==0?(E!==Z&&(K(m,E,m.bl_tree),G--),K(m,A,m.bl_tree),Y(m,G-3,2)):G<=10?(K(m,j,m.bl_tree),Y(m,G-3,3)):(K(m,O,m.bl_tree),Y(m,G-11,7));Z=E,se=(G=0)===q?(X=138,3):E===q?(X=6,3):(X=7,4)}}d(W);var T=!1;function v(m,C,M,P){Y(m,(h<<1)+(P?1:0),3),(function(E,Z,q,G){ie(E),V(E,q),V(E,~q),s.arraySet(E.pending_buf,E.window,Z,q,E.pending),E.pending+=q})(m,C,M)}f._tr_init=function(m){T||((function(){var C,M,P,E,Z,q=new Array(l+1);for(E=P=0;E<u-1;E++)for(B[E]=P,C=0;C<1<<I[E];C++)r[P++]=E;for(r[P-1]=E,E=Z=0;E<16;E++)for(W[E]=Z,C=0;C<1<<U[E];C++)F[Z++]=E;for(Z>>=7;E<i;E++)for(W[E]=Z<<7,C=0;C<1<<U[E]-7;C++)F[256+Z++]=E;for(M=0;M<=l;M++)q[M]=0;for(C=0;C<=143;)J[2*C+1]=8,C++,q[8]++;for(;C<=255;)J[2*C+1]=9,C++,q[9]++;for(;C<=279;)J[2*C+1]=7,C++,q[7]++;for(;C<=287;)J[2*C+1]=8,C++,q[8]++;for(ue(J,_+1,q),C=0;C<i;C++)k[2*C+1]=5,k[2*C]=oe(C,5);te=new ee(J,I,g+1,_,l),H=new ee(k,U,0,i,l),re=new ee(new Array(0),L,0,p,b)})(),T=!0),m.l_desc=new R(m.dyn_ltree,te),m.d_desc=new R(m.dyn_dtree,H),m.bl_desc=new R(m.bl_tree,re),m.bi_buf=0,m.bi_valid=0,ae(m)},f._tr_stored_block=v,f._tr_flush_block=function(m,C,M,P){var E,Z,q=0;0<m.level?(m.strm.data_type===2&&(m.strm.data_type=(function(G){var X,se=4093624447;for(X=0;X<=31;X++,se>>>=1)if(1&se&&G.dyn_ltree[2*X]!==0)return a;if(G.dyn_ltree[18]!==0||G.dyn_ltree[20]!==0||G.dyn_ltree[26]!==0)return n;for(X=32;X<g;X++)if(G.dyn_ltree[2*X]!==0)return n;return a})(m)),pe(m,m.l_desc),pe(m,m.d_desc),q=(function(G){var X;for(e(G,G.dyn_ltree,G.l_desc.max_code),e(G,G.dyn_dtree,G.d_desc.max_code),pe(G,G.bl_desc),X=p-1;3<=X&&G.bl_tree[2*$[X]+1]===0;X--);return G.opt_len+=3*(X+1)+5+5+4,X})(m),E=m.opt_len+3+7>>>3,(Z=m.static_len+3+7>>>3)<=E&&(E=Z)):E=Z=M+5,M+4<=E&&C!==-1?v(m,C,M,P):m.strategy===4||Z===E?(Y(m,2+(P?1:0),3),me(m,J,k)):(Y(m,4+(P?1:0),3),(function(G,X,se,ne){var he;for(Y(G,X-257,5),Y(G,se-1,5),Y(G,ne-4,4),he=0;he<ne;he++)Y(G,G.bl_tree[2*$[he]+1],3);D(G,G.dyn_ltree,X-1),D(G,G.dyn_dtree,se-1)})(m,m.l_desc.max_code+1,m.d_desc.max_code+1,q+1),me(m,m.dyn_ltree,m.dyn_dtree)),ae(m),P&&ie(m)},f._tr_tally=function(m,C,M){return m.pending_buf[m.d_buf+2*m.last_lit]=C>>>8&255,m.pending_buf[m.d_buf+2*m.last_lit+1]=255&C,m.pending_buf[m.l_buf+m.last_lit]=255&M,m.last_lit++,C===0?m.dyn_ltree[2*M]++:(m.matches++,C--,m.dyn_ltree[2*(r[M]+g+1)]++,m.dyn_dtree[2*z(C)]++),m.last_lit===m.lit_bufsize-1},f._tr_align=function(m){Y(m,2,3),K(m,S,J),(function(C){C.bi_valid===16?(V(C,C.bi_buf),C.bi_buf=0,C.bi_valid=0):8<=C.bi_valid&&(C.pending_buf[C.pending++]=255&C.bi_buf,C.bi_buf>>=8,C.bi_valid-=8)})(m)}},{"../utils/common":41}],53:[function(o,y,f){y.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(o,y,f){(function(s){(function(a,n){if(!a.setImmediate){var d,h,u,g,_=1,i={},p=!1,t=a.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(a);l=l&&l.setTimeout?l:a,d={}.toString.call(a.process)==="[object process]"?function(A){process.nextTick(function(){b(A)})}:(function(){if(a.postMessage&&!a.importScripts){var A=!0,j=a.onmessage;return a.onmessage=function(){A=!1},a.postMessage("","*"),a.onmessage=j,A}})()?(g="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",S,!1):a.attachEvent("onmessage",S),function(A){a.postMessage(g+A,"*")}):a.MessageChannel?((u=new MessageChannel).port1.onmessage=function(A){b(A.data)},function(A){u.port2.postMessage(A)}):t&&"onreadystatechange"in t.createElement("script")?(h=t.documentElement,function(A){var j=t.createElement("script");j.onreadystatechange=function(){b(A),j.onreadystatechange=null,h.removeChild(j),j=null},h.appendChild(j)}):function(A){setTimeout(b,0,A)},l.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var j=new Array(arguments.length-1),O=0;O<j.length;O++)j[O]=arguments[O+1];var I={callback:A,args:j};return i[_]=I,d(_),_++},l.clearImmediate=c}function c(A){delete i[A]}function b(A){if(p)setTimeout(b,0,A);else{var j=i[A];if(j){p=!0;try{(function(O){var I=O.callback,U=O.args;switch(U.length){case 0:I();break;case 1:I(U[0]);break;case 2:I(U[0],U[1]);break;case 3:I(U[0],U[1],U[2]);break;default:I.apply(n,U)}})(j)}finally{c(A),p=!1}}}}function S(A){A.source===a&&typeof A.data=="string"&&A.data.indexOf(g)===0&&b(+A.data.slice(g.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof ve<"u"?ve:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ie)),Ie.exports}var bt=gt();const xt=Be(bt),vt={};function _t(){if(typeof window>"u")return $e;const w=vt?.VITE_API_URL;return w&&w.length>0?w.endsWith("/process")?w:`${w.replace(/\/+$/,"")}/process`:window.location.protocol==="file:"?dt:$e}function yt(w){return w>=1024*1024?`${(w/(1024*1024)).toFixed(1)} MB`:w>=1024?`${(w/1024).toFixed(1)} KB`:`${w} B`}function kt(w,N){const y=w.replace(/[_-]+/g," ").replace(/\s+/g," ").split(" ").filter(Boolean);return y.length===0?N:y.map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" ")}function wt(w,N,o,y){const f=w.toLowerCase(),s=y==="crownToChin"||y==="foreheadToChin"||y==="hairToChin"||f.includes("mm")||f.includes("millimeter")||f.includes("millimetre"),a=y==="pixelsPerMm",n=f.includes("px")||f.includes("pixel"),d=f.includes("ratio")||f.includes("percent")||f.includes("percentage");return typeof N=="number"&&Number.isFinite(N)?a?`${N.toFixed(2)} ${o.measurementUnitPxPerMm}`:s?`${N.toFixed(1)} ${o.measurementUnitMm}`:n?`${N.toFixed(0)} ${o.measurementUnitPx}`:d?N.toFixed(2):N.toString():typeof N=="string"&&N.trim().length>0?N.trim():""}function St(w,N){const o=[];if(!w||typeof w!="object")return o;const y=Object.entries(w);for(const[f,s]of y){if(f.toLowerCase()==="face_id")continue;const a=f.toLowerCase();let n=null,d="neutral";a.includes("crown")&&a.includes("chin")?(n="crownToChin",d="primary"):a.includes("forehead")&&a.includes("chin")?(n="foreheadToChin",d="info"):(a.includes("hair")||a.includes("top"))&&a.includes("chin")?(n="hairToChin",d="warning"):a.includes("px")&&(a.includes("mm")||a.includes("per"))&&(n="pixelsPerMm",d="success");const h=n?N.measurementLabels[n]:kt(f,N.measurementFallback),u=wt(f,s,N,n);u&&o.push({label:h,value:u,tone:d})}return o}function ze(w){if(typeof w=="number"&&Number.isFinite(w))return w;if(typeof w=="string"){const N=Number.parseFloat(w);if(Number.isFinite(N))return N}return null}function Pe(w,N){if(w){for(const o of N)if(o in w)return w[o]}}function Ct(w,N,o){return w?[{key:"crown",pxKeys:["crown_px","crownPx"],mmKeys:["crown_mm","crownMm"]},{key:"forehead",pxKeys:["forehead_px","foreheadPx"],mmKeys:["forehead_mm","foreheadMm"]},{key:"chin",pxKeys:["chin_px","chinPx"],mmKeys:["chin_mm","chinMm"]}].map(f=>{const s=ze(Pe(w,f.pxKeys)),a=ze(Pe(w,f.mmKeys));if(s===null)return null;const n=a??(o?s/o:null);return{key:f.key,label:N.markerLabels[f.key],distanceFromBottomPx:s,distanceFromBottomMm:n}}).filter(f=>f!==null):[]}function jt(w,N,o,y){if(!w||N.length===0)return[];const f=new Map(N.map(a=>[a.key,a]));return[{key:"crownToChin",start:"crown",end:"chin",mmKeys:["crown_to_chin_mm","crownToChinMm"],label:y.measurementLabels.crownToChin},{key:"foreheadToChin",start:"forehead",end:"chin",mmKeys:["forehead_to_chin_mm","foreheadToChinMm"],label:y.measurementLabels.foreheadToChin}].map(a=>{const n=f.get(a.start),d=f.get(a.end);if(!n||!d)return null;const h=n.distanceFromBottomPx!==null&&d.distanceFromBottomPx!==null?Math.abs(n.distanceFromBottomPx-d.distanceFromBottomPx):null,g=ze(Pe(w,a.mmKeys))??(o&&h!==null?h/o:null);return h===null&&g===null?null:{key:a.key,label:a.label,startKey:a.start,endKey:a.end,pixels:h,millimeters:g}}).filter(a=>a!==null)}function Nt(w,N){const o=ze(Pe(w,["px_per_mm","pxPerMm"])),y=Ct(w,N,o),f=jt(w,y,o,N);return{markers:y,spans:f,pxPerMm:o??null}}function At(w){if(!w||typeof w!="object")return w;const N=w;return N.measurements&&typeof N.measurements=="object"?N.measurements:N.metrics&&typeof N.metrics=="object"?N.metrics:w}function Fe(w,N){if(!w||typeof w!="object")return`face${String(N+1).padStart(2,"0")}`.toLowerCase();const o=w,y=o.face_id??o.faceId??o.id??o.identifier;if(typeof y=="string"&&y.trim().length>0)return y.trim().toLowerCase();const f=o.index;if(typeof f=="number"&&Number.isFinite(f)){const s=Math.max(1,Math.round(f));return`face${String(s).padStart(2,"0")}`.toLowerCase()}return`face${String(N+1).padStart(2,"0")}`.toLowerCase()}function Et(w,N){const o={};if(!w)return o;const y=[];return Array.isArray(w.faces)?w.faces.forEach((s,a)=>{y.push({id:Fe(s,a),payload:s})}):Array.isArray(w)?w.forEach((f,s)=>{y.push({id:Fe(f,s),payload:f})}):y.push({id:Fe(w,0),payload:w}),y.forEach(({id:f,payload:s})=>{const a=At(s),n=St(a,N),d=s&&typeof s=="object"?s:null;o[f]={metrics:n,raw:d}}),o}function Le(w){if(!w)return null;if(typeof w=="string"){const N=w.trim();return N.length>0?N:null}if(Array.isArray(w)){for(const N of w){const o=Le(N);if(o)return o}return null}if(typeof w=="object"){const N=w;if(typeof N.detail=="string")return N.detail.trim()||null;if(Array.isArray(N.detail)){const o=Le(N.detail);if(o)return o}if(typeof N.message=="string")return N.message.trim()||null}return null}async function zt(w,N){const o=await xt.loadAsync(w),y=o.file(/metadata\.json$/i)?.[0];let f=null;if(y)try{const g=await y.async("text");f=JSON.parse(g)}catch(g){console.warn("Unable to parse metadata.json",g)}const s=Et(f,N),a=new Map,n=[];o.forEach((g,_)=>{if(_.dir)return;const i=g.toLowerCase(),p=i.match(ft),t=p?p[1].toLowerCase():"face01";if(Ge.test(i)||Ke.test(i)){const l=Ge.test(i),c=Ke.test(i);n.push(_.async("blob").then(b=>{const S=g.split("/").pop()??`${t}.jpg`,A={blob:b,url:URL.createObjectURL(b),filename:S},j=a.get(t)??{};l&&(j.balanced=A),c&&(j.annotated=A),a.set(t,j)}))}}),await Promise.all(n);const d=new Set([...a.keys(),...Object.keys(s)]);return d.size===0&&d.add("face01"),Array.from(d).sort().map(g=>{const _=a.get(g)??{},i=s[g],p=Nt(i?.raw??null,N);return{id:g,balanced:_.balanced??null,annotated:_.annotated??null,metrics:i?.metrics??[],markers:p.markers,spans:p.spans,pxPerMm:p.pxPerMm}})}function Pt(w){if(!w)return{valid:!1,reason:"missing"};const N=ut.includes(w.type),o=/\.(jpe?g|png|heic|heif|webp)$/i.test(w.name);return!N&&!o?{valid:!1,reason:"type"}:w.size>ct?{valid:!1,reason:"size"}:{valid:!0}}function Lt(w,N){w.append("target_height_mm",String(N.target_height_mm)),w.append("min_height_px",String(N.min_height_px)),w.append("min_width_px",String(N.min_width_px)),w.append("target_w_over_h",String(N.target_w_over_h)),w.append("top_margin_ratio",String(N.top_margin_ratio)),w.append("bottom_upper_ratio",String(N.bottom_upper_ratio)),w.append("max_crown_to_chin_mm",String(N.max_crown_to_chin_mm)),w.append("min_crown_to_chin_mm",String(N.min_crown_to_chin_mm)),w.append("target_crown_to_chin_mm",String(N.target_crown_to_chin_mm)),w.append("max_extra_padding_px",String(N.max_extra_padding_px))}function Rt(w){w.forEach(N=>{N.balanced&&URL.revokeObjectURL(N.balanced.url),N.annotated&&URL.revokeObjectURL(N.annotated.url)})}function Tt({messages:w,status:N,isDragActive:o,file:y,filePreview:f,onDragOver:s,onDragLeave:a,onDrop:n,onOpenFileDialog:d,onOpenCameraDialog:h,onFileInputChange:u,onRemoveFile:g,fileInputRef:_,cameraInputRef:i}){const p=l=>{s(l)},t=l=>{n(l)};return x.jsxs("section",{"aria-labelledby":"upload-section",className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition dark:border-slate-800 dark:bg-slate-900",children:[x.jsxs("div",{className:"flex items-center justify-between gap-4",children:[x.jsxs("div",{children:[x.jsx("h2",{id:"upload-section",className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:w.uploadHeading}),x.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:w.defaultsHint})]}),y&&x.jsx("button",{type:"button",onClick:g,className:"text-sm font-medium text-rose-600 transition hover:text-rose-700 focus:outline-none focus:ring-2 focus:ring-rose-400 dark:text-rose-300 dark:hover:text-rose-200",children:w.removeFile})]}),x.jsxs("div",{role:"region","aria-label":w.ariaUploadZone,onDragOver:p,onDragLeave:a,onDrop:t,className:fe("mt-4 flex flex-col items-center justify-center rounded-xl border-2 border-dashed px-5 py-10 text-center transition",N==="processing"?"cursor-not-allowed border-slate-200 bg-slate-100 text-slate-500 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-400":o?"border-sky-400 bg-sky-50 text-sky-600 shadow-inner dark:border-sky-500 dark:bg-sky-950/40 dark:text-sky-300":"border-slate-300 bg-slate-50 text-slate-600 dark:border-slate-700 dark:bg-slate-800/70 dark:text-slate-300"),children:[x.jsxs("div",{className:"flex flex-col items-center gap-3",children:[x.jsx("span",{className:"flex h-14 w-14 items-center justify-center rounded-full border border-slate-200 bg-white text-sky-500 shadow-sm dark:border-slate-700 dark:bg-slate-900","aria-hidden":"true",children:x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",className:"h-7 w-7",children:x.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v2.5A1.5 1.5 0 0 0 5.5 20h13a1.5 1.5 0 0 0 1.5-1.5V16M16 8l-4-4m0 0L8 8m4-4v12"})})}),x.jsxs("div",{className:"space-y-1",children:[x.jsx("p",{className:"text-base font-medium text-slate-900 dark:text-slate-100",children:o?w.dragActive:w.dragDrop}),x.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:w.dragDropHint})]}),x.jsxs("div",{className:"flex flex-col items-center gap-2 text-sm text-slate-600 dark:text-slate-300",children:[x.jsx("span",{children:w.or}),x.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[x.jsx("button",{type:"button",onClick:d,disabled:N==="processing",className:"rounded-md bg-sky-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-sky-600 focus:outline-none focus:ring-4 focus:ring-sky-200 disabled:cursor-not-allowed disabled:bg-slate-300 dark:bg-sky-600 dark:hover:bg-sky-500 dark:focus:ring-sky-900",children:w.chooseFile}),x.jsx("button",{type:"button",onClick:h,disabled:N==="processing",className:"rounded-md border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:border-sky-400 hover:text-sky-600 focus:outline-none focus:ring-4 focus:ring-sky-200 disabled:cursor-not-allowed disabled:border-slate-200 disabled:text-slate-400 dark:border-slate-700 dark:text-slate-200 dark:hover:border-sky-500 dark:hover:text-sky-300 dark:focus:ring-sky-900",children:w.useCamera})]})]})]}),x.jsx("input",{ref:_,type:"file",accept:"image/*",className:"hidden",onChange:l=>u(l.target.files?.[0]??null)}),x.jsx("input",{ref:i,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:l=>u(l.target.files?.[0]??null)})]}),y&&f&&x.jsxs("div",{className:"mt-5 flex items-center gap-4 rounded-xl border border-slate-200 bg-slate-50 p-3 dark:border-slate-700 dark:bg-slate-800",children:[x.jsx("img",{src:f,alt:w.previewAlt,className:"h-16 w-16 rounded-lg object-cover shadow-sm"}),x.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[x.jsx("p",{className:"truncate text-sm font-semibold text-slate-900 dark:text-slate-100",children:y.name}),x.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:yt(y.size)}),x.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:w.fileNameLabel})]})]}),x.jsx("p",{className:"mt-4 text-sm text-slate-500 dark:text-slate-400",children:w.privacyNote})]})}const It=.3,Ft=2;function Dt({widthHeightRatio:w,topMarginRatio:N,lowerFaceRatio:o}){const y=Q.useMemo(()=>Mt(w,N,o),[o,N,w]);return x.jsxs("div",{className:"flex flex-col gap-3 rounded-xl border border-slate-200 bg-white/80 p-4 shadow-inner dark:border-slate-700 dark:bg-slate-900/60",children:[x.jsx("div",{className:"text-sm font-semibold text-slate-700 dark:text-slate-200",children:"Live framing preview"}),x.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Adjust the controls to see how the top margin, lower face ratio, and width/height ratio change the crop box and face placement."}),x.jsx("div",{className:"relative mx-auto w-full max-w-[180px] rounded-lg border border-slate-300 bg-white dark:border-slate-700 dark:bg-slate-900/70",children:x.jsx("div",{className:"relative w-full",style:{paddingBottom:`${y.paddingBottomPercent}%`},children:x.jsxs("div",{className:"absolute inset-0",children:[x.jsx(Ae,{topPercent:0,label:"Top"}),x.jsx(Ae,{topPercent:y.crownPercent,label:"Crown",tone:"primary"}),x.jsx(Ae,{topPercent:y.chinPercent,label:"Chin",tone:"accent"}),x.jsx(Ae,{topPercent:100,label:"Bottom"}),x.jsx(Ot,{geometry:y}),x.jsx(Bt,{geometry:y})]})})}),x.jsxs("div",{className:"grid gap-2 text-xs text-slate-600 dark:text-slate-400 sm:grid-cols-3",children:[x.jsx(De,{label:"Aspect",value:`${y.safeRatio.toFixed(2)} : 1`}),x.jsx(De,{label:"Top margin",value:`${y.topMarginPercent.toFixed(0)}%`}),x.jsx(De,{label:"Lower padding",value:`${y.bottomMarginPercent.toFixed(0)}%`})]})]})}function Ae({topPercent:w,label:N,tone:o}){return x.jsxs("div",{className:fe("absolute left-0 flex w-full items-center gap-2 px-2",o==="primary"&&"text-sky-500",o==="accent"&&"text-emerald-500",!o&&"text-slate-400"),style:{top:`${w}%`,transform:"translateY(-50%)"},children:[x.jsx("div",{className:fe("h-px flex-1 bg-slate-300 dark:bg-slate-600",o==="primary"&&"bg-sky-400 dark:bg-sky-500",o==="accent"&&"bg-emerald-400 dark:bg-emerald-500")}),x.jsx("span",{className:"rounded-full bg-white/70 px-2 py-0.5 text-[1rem] font-semibold uppercase tracking-wide shadow dark:bg-slate-900/70 ",children:N})]})}function De({label:w,value:N}){return x.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white/60 p-2 text-center shadow-sm dark:border-slate-700 dark:bg-slate-900/60",children:[x.jsx("div",{className:"text-[0.65rem] uppercase tracking-wide text-slate-500 dark:text-slate-400",children:w}),x.jsx("div",{className:"text-sm font-semibold text-slate-700 dark:text-slate-100",children:N})]})}function Ye(w,N,o){return Math.min(Math.max(w,N),o)}function Ot({geometry:w}){const{crownPercent:N,ellipseHeightPercent:o,ellipseWidthPercent:y,faceHeightPercent:f}=w,s={height:`${o}%`,width:`${y}%`,background:"radial-gradient(circle at 50% 30%, rgba(252, 211, 77, 0.6), rgba(251, 191, 36, 0.25))",boxShadow:"0 10px 25px rgba(30, 41, 59, 0.15)"};return x.jsx("div",{className:"absolute flex flex-col items-center",style:{top:`${N}%`,left:"50%",transform:"translate(-50%, 0)"},children:x.jsx("div",{className:"rounded-full border border-amber-400/60 dark:border-amber-300/60",style:s})})}function Bt({geometry:w}){const{chinPercent:N,ellipseWidthPercent:o,shoulderHeightPercent:y}=w;if(y<=0)return null;const s={width:`${Math.min(o*1.6,98)}%`,height:`${y}%`,borderBottomLeftRadius:"50% 100%",borderBottomRightRadius:"50% 100%",background:"linear-gradient(180deg, rgba(148, 163, 184, 0.25), rgba(71, 85, 105, 0.4))"};return x.jsx("div",{className:"absolute flex justify-center",style:{top:`${N}%`,left:"50%",transform:"translate(-50%, 0)"},children:x.jsx("div",{className:"overflow-hidden",style:s})})}function Mt(w,N,o){const y=Ye(w,It,Ft),f=Math.max(N,0),s=Ye(o,.05,.95),a=1,n=f*a,d=n,h=n+a,u=Math.max(h/s,h+1e-6),g=Math.max(u-h,0),_=d/u*100,i=h/u*100,p=_,t=g/u*100,l=a/u*100,c=l,b=Math.min(l*y,95),S=Math.max(t,0),A=Math.min(100,i),j=1/y*100;return{safeRatio:y,paddingBottomPercent:j,crownPercent:_,chinPercent:i,topMarginPercent:p,bottomMarginPercent:t,faceHeightPercent:l,ellipseHeightPercent:c,ellipseWidthPercent:b,shoulderHeightPercent:S,shoulderTopPercent:A,topMargin:n,bottomMargin:g,faceHeight:a}}function Ut({messages:w,formValues:N,onOptionChange:o,onToggleDebug:y,status:f,canSubmit:s,onRetry:a}){const[n,d]=Q.useState(!1),h=f==="processing";return x.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition dark:border-slate-800 dark:bg-slate-900",children:[x.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:w.optionsHeading}),x.jsx("p",{className:"mt-1 text-sm text-slate-600 dark:text-slate-300",children:w.validationGuidelines}),x.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[x.jsx(_e,{label:w.targetHeightLabel,suffix:w.targetHeightSuffix,value:N.target_height_mm,onChange:u=>o("target_height_mm",u),min:35,max:70,step:.5,disabled:h}),x.jsx(_e,{label:w.minHeightLabel,suffix:w.pixelsSuffix,value:N.min_height_px,onChange:u=>o("min_height_px",u),min:200,step:10,disabled:h}),x.jsx(_e,{label:w.minWidthLabel,suffix:w.pixelsSuffix,value:N.min_width_px,onChange:u=>o("min_width_px",u),min:200,step:10,disabled:h}),x.jsxs("label",{className:"flex items-start gap-3 rounded-lg border border-slate-200 bg-slate-50 p-3 text-sm text-slate-700 shadow-inner dark:border-slate-700 dark:bg-slate-800 dark:text-slate-200",children:[x.jsx("input",{type:"checkbox",checked:N.save_debug,onChange:y,disabled:h,className:"mt-0.5 h-4 w-4 rounded border-slate-300 text-sky-500 focus:ring-sky-400 dark:border-slate-600 dark:bg-slate-900"}),x.jsxs("span",{children:[x.jsx("span",{className:"font-semibold",children:w.saveDebugLabel}),x.jsx("br",{}),x.jsx("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:w.saveDebugDescription})]})]})]}),x.jsxs("div",{className:"mt-4 rounded-xl border border-slate-200 bg-slate-50 p-4 dark:border-slate-700 dark:bg-slate-800",children:[x.jsxs("button",{type:"button",onClick:()=>d(u=>!u),className:"flex w-full items-center justify-between gap-2 text-sm font-semibold text-slate-700 transition hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-sky-400 dark:text-slate-200 dark:hover:text-white","aria-expanded":n,"aria-controls":"advanced-options","aria-label":w.ariaAdvancedToggle,children:[x.jsx("span",{children:w.advancedHeading}),x.jsx("span",{className:"text-xs font-normal text-slate-500 dark:text-slate-400",children:w.advancedSummary})]}),n&&x.jsxs("div",{id:"advanced-options",className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[x.jsx(Ht,{label:w.targetRatioLabel,value:N.target_w_over_h,onChange:u=>o("target_w_over_h",u),min:.5,max:1.5,disabled:h}),x.jsx(Je,{label:w.topMarginLabel,value:N.top_margin_ratio,onChange:u=>o("top_margin_ratio",u),minPercent:0,maxPercent:50,disabled:h}),x.jsx(Je,{label:w.bottomUpperLabel,value:N.bottom_upper_ratio,onChange:u=>o("bottom_upper_ratio",u),minPercent:50,maxPercent:100,disabled:h}),x.jsx("div",{className:"sm:col-span-2",children:x.jsx(Dt,{widthHeightRatio:N.target_w_over_h,topMarginRatio:N.top_margin_ratio,lowerFaceRatio:N.bottom_upper_ratio})}),x.jsx(_e,{label:w.maxCrownToChinLabel,suffix:w.measurementUnitMm,value:N.max_crown_to_chin_mm,onChange:u=>o("max_crown_to_chin_mm",u),step:.5,min:10,max:60,disabled:h}),x.jsx(_e,{label:w.minCrownToChinLabel,suffix:w.measurementUnitMm,value:N.min_crown_to_chin_mm,onChange:u=>o("min_crown_to_chin_mm",u),step:.5,min:10,max:60,disabled:h}),x.jsx(_e,{label:w.targetCrownToChinLabel,suffix:w.measurementUnitMm,value:N.target_crown_to_chin_mm,onChange:u=>o("target_crown_to_chin_mm",u),step:.5,min:10,max:60,disabled:h}),x.jsx(_e,{label:w.maxExtraPaddingLabel,suffix:w.pixelsSuffix,value:N.max_extra_padding_px,onChange:u=>o("max_extra_padding_px",u),step:10,min:0,max:2e3,disabled:h})]})]}),x.jsxs("div",{className:"mt-5 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[x.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:w.processingTimeHint}),x.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[f==="error"&&x.jsx("button",{type:"button",onClick:a,className:"rounded-md border border-rose-200 px-4 py-2 text-sm font-semibold text-rose-600 transition hover:border-rose-300 hover:text-rose-700 focus:outline-none focus:ring-4 focus:ring-rose-200 dark:border-rose-900 dark:text-rose-300 dark:hover:border-rose-700 dark:hover:text-rose-100 dark:focus:ring-rose-900",children:w.retryButton}),x.jsx("button",{type:"submit",disabled:!s,className:"rounded-md bg-sky-600 px-5 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-sky-700 focus:outline-none focus:ring-4 focus:ring-sky-200 disabled:cursor-not-allowed disabled:bg-slate-300 dark:bg-sky-500 dark:hover:bg-sky-400 dark:focus:ring-sky-900",children:w.submitButton})]})]}),!s&&f!=="processing"&&x.jsx("p",{className:"mt-2 text-xs text-slate-500 dark:text-slate-400",children:w.submitDisabled})]})}function _e({label:w,value:N,onChange:o,suffix:y,step:f,min:s,max:a,disabled:n}){return x.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700 dark:text-slate-200",children:[x.jsx("span",{children:w}),x.jsxs("div",{className:"relative flex items-center",children:[x.jsx("input",{type:"number",inputMode:"decimal",value:N,min:s,max:a,step:f,disabled:n,onChange:d=>{const h=Number.parseFloat(d.target.value);o(Number.isFinite(h)?h:N)},className:fe("w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-4 focus:ring-sky-200 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:focus:border-sky-400 dark:focus:ring-sky-900",n&&"opacity-60")}),y&&x.jsx("span",{className:"pointer-events-none absolute right-2 text-xs text-slate-500 dark:text-slate-400",children:y})]})]})}function Ht({label:w,value:N,onChange:o,disabled:y,min:f,max:s}){const a=Q.useMemo(()=>Zt(N),[N]),[n,d]=Q.useState(a.numerator),[h,u]=Q.useState(a.denominator),g=(p,t)=>{if(!Number.isFinite(p)||!Number.isFinite(t)||t<=0)return;const l=p/t;if(!Number.isFinite(l))return;const c=Oe(l,f,s);o(c)},_=p=>{const t=Number.parseFloat(p),l=Number.isFinite(t)?Math.max(Math.round(t),0):n;d(l),g(l,h)},i=p=>{const t=Number.parseFloat(p),l=Number.isFinite(t)?Math.max(Math.round(t),1):h;u(l),g(n,l)};return x.jsxs("label",{className:"flex flex-col gap-1 text-sm font-medium text-slate-700 dark:text-slate-200",children:[x.jsx("span",{children:w}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("input",{type:"number",inputMode:"numeric",value:Xe(n),onChange:p=>_(p.target.value),disabled:y,min:0,className:fe("w-20 rounded-md border border-slate-300 bg-white px-2 py-2 text-sm text-slate-900 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-4 focus:ring-sky-200 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:focus:border-sky-400 dark:focus:ring-sky-900",y&&"opacity-60")}),x.jsx("span",{className:"text-base font-semibold text-slate-500 dark:text-slate-400",children:":"}),x.jsx("input",{type:"number",inputMode:"numeric",value:Xe(h),onChange:p=>i(p.target.value),disabled:y,min:1,className:fe("w-20 rounded-md border border-slate-300 bg-white px-2 py-2 text-sm text-slate-900 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-4 focus:ring-sky-200 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:focus:border-sky-400 dark:focus:ring-sky-900",y&&"opacity-60")})]})]})}function Je({label:w,value:N,onChange:o,minPercent:y,maxPercent:f,disabled:s}){const a=Oe(Math.round(N*100),y,f),n=d=>{const h=Number.parseInt(d.target.value,10);if(!Number.isFinite(h))return;const u=Oe(h,y,f);o(u/100)};return x.jsxs("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700 dark:text-slate-200",children:[x.jsxs("span",{className:"flex items-center justify-between",children:[x.jsx("span",{children:w}),x.jsxs("span",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400",children:[a,"%"]})]}),x.jsx("input",{type:"range",min:y,max:f,value:a,step:1,disabled:s,onChange:n,className:"h-2 w-full cursor-pointer appearance-none rounded-full bg-slate-200 accent-sky-500 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 dark:bg-slate-700"})]})}function Oe(w,N,o){let y=w;return typeof N=="number"&&(y=Math.max(y,N)),typeof o=="number"&&(y=Math.min(y,o)),y}function Zt(w){if(!Number.isFinite(w)||w<=0)return{numerator:1,denominator:1};const N=50;let o=1,y=1,f=Number.POSITIVE_INFINITY;for(let s=1;s<=N;s+=1){const a=Math.max(1,Math.round(w*s)),n=a/s,d=Math.abs(n-w);if(d<f&&(f=d,o=a,y=s),f===0)break}return{numerator:o,denominator:y}}function Xe(w){if(!Number.isFinite(w))return"";const N=Math.round(w*1e3)/1e3;return Number.isInteger(N)?`${N}`:N.toString()}function Wt({messages:w}){return x.jsxs("section",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition dark:border-slate-800 dark:bg-slate-900",children:[x.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:w.guidelinesHeading}),x.jsx("ul",{className:"mt-4 space-y-3",children:w.guidelines.map(N=>x.jsxs("li",{className:"flex items-start gap-3 text-sm text-slate-600 dark:text-slate-300",children:[x.jsx("span",{className:"mt-0.5 inline-flex h-5 w-5 flex-shrink-0 items-center justify-center rounded-full bg-sky-500 text-white",children:x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"h-3 w-3",children:x.jsx("path",{d:"M5 10l3 3 7-7",strokeLinecap:"round",strokeLinejoin:"round"})})}),x.jsx("span",{children:N})]},N))}),x.jsxs("a",{href:"/help",target:"_blank",rel:"noreferrer",className:"mt-5 inline-flex items-center gap-2 text-sm font-semibold text-sky-600 transition hover:text-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-400 dark:text-sky-400 dark:hover:text-sky-300","aria-label":w.helpLinkHint,children:[x.jsx("span",{children:w.tipsHeading}),x.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"1.6",className:"h-4 w-4",children:[x.jsx("path",{d:"M5 5h10v10",strokeLinecap:"round"}),x.jsx("path",{d:"M5 15 15 5",strokeLinecap:"round"})]})]}),x.jsx("p",{className:"mt-2 text-xs text-slate-500 dark:text-slate-400",children:w.helpLinkHint})]})}function $t({messages:w,statusLabel:N,phaseStatusText:o,progressPercent:y,phaseIndex:f}){return x.jsxs("section",{"aria-labelledby":"status-tracker",className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition dark:border-slate-800 dark:bg-slate-900",children:[x.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[x.jsxs("div",{children:[x.jsx("h2",{id:"status-tracker",className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:w.phaseTrackerHeading}),x.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:N})]}),x.jsxs("div",{className:"flex flex-col items-start gap-2 sm:items-end",children:[x.jsx("span",{className:"text-xs font-medium uppercase tracking-wide text-slate-500 dark:text-slate-400",children:o}),x.jsx("div",{role:"progressbar","aria-label":w.progressLabel,"aria-valuenow":y,"aria-valuemin":0,"aria-valuemax":100,className:"flex h-2 w-48 items-center overflow-hidden rounded-full border border-slate-200 bg-slate-100 dark:border-slate-700 dark:bg-slate-800",children:x.jsx("span",{className:"h-full bg-sky-500 transition-all duration-500 ease-out dark:bg-sky-400",style:{width:`${y}%`}})})]})]}),x.jsx("ol",{className:"mt-6 grid grid-cols-2 gap-3 text-sm sm:grid-cols-3 lg:grid-cols-7",children:ye.map((s,a)=>{const n=f>a,d=f===a;return x.jsxs("li",{className:fe("flex items-center gap-3 rounded-lg border p-3",n?"border-sky-200 bg-sky-50 text-sky-700 dark:border-sky-800 dark:bg-sky-950/40 dark:text-sky-300":d?"border-sky-400 bg-white text-sky-700 shadow-sm dark:border-sky-500 dark:bg-slate-900 dark:text-sky-300":"border-slate-200 bg-white text-slate-500 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-400"),children:[x.jsx("span",{className:fe("flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full border text-xs font-semibold",n?"border-sky-400 bg-sky-500 text-white":d?"border-sky-500 bg-sky-100 text-sky-700 dark:bg-sky-950/40":"border-slate-300 bg-slate-100 text-slate-500 dark:border-slate-700 dark:bg-slate-800"),children:a+1}),x.jsx("span",{className:"font-medium",children:w.phaseLabels[s]})]},s)})})]})}const xe={crown:"#ef4444",forehead:"#f97316",chin:"#22c55e"},Ve={crownToChin:xe.crown,foreheadToChin:xe.forehead};function Gt({image:w,markers:N,spans:o,messages:y}){const[f,s]=Q.useState(null),[a,n]=Q.useState(null),[d,h]=Q.useState(null);Q.useEffect(()=>{s(null),n(null),h(null)},[w?.url]),Q.useEffect(()=>{a&&!o.some(t=>t.key===a)&&n(null),d&&!o.some(t=>t.key===d)&&h(null)},[a,d,o]);const u=Q.useMemo(()=>{if(!f)return[];const t=Math.max(f.height,1);return N.map(l=>{if(l.distanceFromBottomPx===null)return null;const c=100-l.distanceFromBottomPx/t*100,b=Math.min(100,Math.max(0,c));return{...l,positionPercent:b}}).filter(l=>l!==null)},[N,f]),g=Q.useMemo(()=>{const t=u.map(l=>[l.key,l]);return new Map(t)},[u]),_=Q.useMemo(()=>!f||g.size===0?[]:o.map(t=>{const l=g.get(t.startKey),c=g.get(t.endKey);if(!l||!c)return null;const b=Math.min(l.positionPercent,c.positionPercent),S=Math.max(l.positionPercent,c.positionPercent),A=Math.min(100,Math.max(0,b)),O=Math.min(100,Math.max(0,S))-A,I=Math.max(O,.5),U=Math.min(A,100-I),L=Math.min(100,U+I),$=Ve[t.key]??xe.chin,J=L-U,k=U+J/2,F=J>0?(k-U)/J*100:50,r=Math.min(Math.max(F,0),100);return{span:t,topPercent:U,bottomPercent:L,heightPercent:J,color:$,midpointPercent:k,labelOffsetPercent:r}}).filter(t=>t!==null),[g,f,o]),i=y.measurementUnitPx,p=y.measurementUnitMm;return x.jsxs("div",{className:"flex flex-col gap-4",children:[x.jsx("div",{className:"relative mx-auto w-full max-w-xs overflow-hidden rounded-xl border border-slate-200 bg-slate-100 shadow-inner dark:border-slate-700 dark:bg-slate-800",children:w?x.jsxs(x.Fragment,{children:[x.jsx("img",{src:w.url,alt:y.annotatedAlt,className:"block w-full object-cover",onLoad:t=>{const l=t.currentTarget;s({width:l.naturalWidth,height:l.naturalHeight})}}),f&&u.length>0&&x.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[u.map(t=>{const l=xe[t.key]??xe.chin,c=t.positionPercent<16;return x.jsx("div",{className:"pointer-events-none absolute inset-x-0",style:{top:`${t.positionPercent}%`},children:x.jsxs("div",{className:"relative",children:[x.jsx("div",{className:"h-[2px] w-full",style:{backgroundColor:l,boxShadow:`0 0 6px ${l}55`}}),x.jsxs("div",{className:fe("absolute left-2 inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold text-slate-900 shadow-lg ring-1 ring-black/10 backdrop-blur","dark:text-slate-900 dark:ring-white/10",c?"translate-y-1 bg-white/90 dark:bg-slate-200/90":"-translate-y-full -translate-y-2 bg-white/90 dark:bg-slate-200/90"),title:t.distanceFromBottomPx!==null?`${t.label} - ${Math.round(t.distanceFromBottomPx)} ${y.measurementUnitPx}`:t.label,children:[x.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full",style:{backgroundColor:l},"aria-hidden":"true"}),t.label]})]})},t.key)}),_.map(({span:t,topPercent:l,heightPercent:c,color:b,labelOffsetPercent:S})=>{const A=a===t.key,j=d===t.key,O=A||j,I=[];t.pixels!==null&&I.push(`${Math.round(t.pixels)} ${i}`),t.millimeters!==null&&I.push(`${t.millimeters.toFixed(2)} ${p}`);const U=I.length>0?`${t.label}. ${I.join(" / ")}`:t.label;return x.jsx("div",{className:"absolute right-2 flex w-20 justify-end",style:{top:`${l}%`,height:`${c}%`},children:x.jsxs("button",{type:"button","aria-label":U,"aria-pressed":j,onPointerEnter:()=>n(t.key),onPointerLeave:()=>n(null),onFocus:()=>n(t.key),onBlur:()=>n(null),onClick:()=>h(L=>L===t.key?null:t.key),className:"group relative h-full w-full cursor-pointer select-none rounded-lg focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 pointer-events-auto",style:{background:"none"},children:[x.jsxs("span",{className:"pointer-events-none absolute inset-0",children:[x.jsx("div",{className:"absolute right-6 top-0 h-full w-[3px] rounded-full",style:{backgroundColor:`${b}dd`}}),x.jsx("div",{className:"absolute right-[18px] h-3 w-3 -translate-x-1/2 rounded-full",style:{top:"0",backgroundColor:b},"aria-hidden":"true"}),x.jsx("div",{className:"absolute right-[18px] h-3 w-3 -translate-x-1/2 rounded-full",style:{bottom:"0",backgroundColor:b},"aria-hidden":"true"})]}),x.jsxs("span",{className:fe("pointer-events-none absolute right-0 flex max-w-[150px] -translate-y-1/2 flex-col gap-0 rounded-lg bg-white/95 px-3 py-2 text-[0.65rem] font-medium text-slate-900 shadow-lg ring-1 ring-black/5 transition-all duration-150 dark:bg-slate-900/90 dark:text-slate-100 dark:ring-white/10",O?"translate-x-3 opacity-100":"translate-x-1 opacity-0"),style:{top:`${S}%`},children:[x.jsx("span",{children:t.label}),x.jsxs("span",{className:"text-[0.6rem] font-normal text-slate-500 dark:text-slate-300",children:[t.pixels!==null&&`${Math.round(t.pixels)} ${i}`,t.pixels!==null&&t.millimeters!==null&&" / ",t.millimeters!==null&&`${t.millimeters.toFixed(2)} ${p}`]})]})]})},t.key)})]})]}):x.jsx("div",{className:"flex aspect-[35/45] items-center justify-center text-sm text-slate-500 dark:text-slate-300",children:y.loadingPlaceholder})}),x.jsxs("div",{className:"space-y-3",children:[x.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400",children:y.overlayLegendHeading}),N.length>0?x.jsx("div",{className:"flex flex-col gap-2",children:N.map(t=>{const l=xe[t.key]??xe.chin;return x.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-white/80 px-3 py-2 text-sm shadow-sm dark:border-slate-700 dark:bg-slate-900/70",children:[x.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-700 dark:text-slate-200",children:[x.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full",style:{backgroundColor:l},"aria-hidden":"true"}),t.label]}),x.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:[t.distanceFromBottomPx!==null&&`${Math.round(t.distanceFromBottomPx)} ${y.measurementUnitPx}`,t.distanceFromBottomPx!==null&&t.distanceFromBottomMm!==null&&" / ",t.distanceFromBottomMm!==null&&`${t.distanceFromBottomMm.toFixed(1)} ${y.measurementUnitMm}`]})]},`legend-${t.key}`)})}):x.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-300",children:y.metadataMissing}),o.length>0&&x.jsx("div",{className:"flex flex-col gap-2",children:o.map(t=>{const l=Ve[t.key]??xe.chin;return x.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-slate-200 bg-white/80 px-3 py-2 text-sm shadow-sm dark:border-slate-700 dark:bg-slate-900/70",children:[x.jsxs("span",{className:"flex items-center gap-2 font-medium text-slate-700 dark:text-slate-200",children:[x.jsx("span",{className:"inline-flex h-2.5 w-2.5 rounded-full",style:{backgroundColor:l},"aria-hidden":"true"}),t.label]}),x.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:[t.pixels!==null&&`${Math.round(t.pixels)} ${y.measurementUnitPx}`,t.pixels!==null&&t.millimeters!==null&&" / ",t.millimeters!==null&&`${t.millimeters.toFixed(2)} ${y.measurementUnitMm}`]})]},`span-${t.key}`)})})]})]})}function Kt({status:w,messages:N,errorMessage:o,multipleFaces:y,currentFace:f,faceResults:s,selectedFaceIndex:a,onSelectPreviousFace:n,onSelectNextFace:d,onDownloadZip:h,onDownloadAsset:u,zipBlob:g,badgeStyles:_}){return x.jsxs("section",{"aria-labelledby":"results-section","aria-live":"polite","aria-busy":w==="processing",className:"rounded-2xl border border-slate-200 bg-white p-5 shadow-sm transition dark:border-slate-800 dark:bg-slate-900",children:[x.jsxs("div",{className:"flex flex-col gap-2",children:[x.jsx("h2",{id:"results-section",className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:N.resultsHeading}),x.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:y?N.resultsDescriptionMulti:N.resultsDescriptionSingle})]}),o&&x.jsx("div",{role:"alert",className:"mt-4 rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700 dark:border-rose-900 dark:bg-rose-950 dark:text-rose-200",children:o}),w==="idle"&&x.jsxs("div",{className:"mt-6 rounded-xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center text-sm text-slate-500 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300",children:[x.jsx("p",{className:"text-base font-semibold text-slate-700 dark:text-slate-100",children:N.emptyStateTitle}),x.jsx("p",{className:"mt-1 text-sm",children:N.emptyStateDescription})]}),(w==="ready"||w==="validating")&&!o&&x.jsx("div",{className:"mt-6 rounded-xl border border-dashed border-sky-200 bg-sky-50 p-6 text-sm text-sky-700 dark:border-sky-800 dark:bg-sky-950/40 dark:text-sky-300",children:N.validationGuidelines}),w==="processing"&&x.jsxs("div",{className:"mt-6 grid gap-4 sm:grid-cols-2",children:[[0,1].map(i=>x.jsx("div",{className:"h-52 animate-pulse rounded-xl border border-slate-200 bg-slate-100/80 dark:border-slate-700 dark:bg-slate-800"},i)),x.jsx("div",{className:"sm:col-span-2",children:x.jsx("div",{className:"h-16 animate-pulse rounded-xl border border-slate-200 bg-slate-100/80 dark:border-slate-700 dark:bg-slate-800"})})]}),w==="success"&&f&&x.jsxs("div",{className:"mt-6 space-y-6",children:[y&&x.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[x.jsxs("div",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:[N.faceLabel,": ",N.facePosition.replace("{current}",String(a+1)).replace("{total}",String(s.length))]}),x.jsxs("div",{className:"flex items-center gap-2",children:[x.jsx("button",{type:"button",onClick:n,"aria-label":N.faceSelectorPrev,className:"rounded-full border border-slate-200 p-2 text-slate-600 transition hover:border-sky-400 hover:text-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 dark:border-slate-700 dark:text-slate-300 dark:hover:border-sky-500 dark:hover:text-sky-300",children:x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"1.6",className:"h-4 w-4",children:x.jsx("path",{d:"M12 5 7 10l5 5",strokeLinecap:"round",strokeLinejoin:"round"})})}),x.jsx("button",{type:"button",onClick:d,"aria-label":N.faceSelectorNext,className:"rounded-full border border-slate-200 p-2 text-slate-600 transition hover:border-sky-400 hover:text-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-400 dark:border-slate-700 dark:text-slate-300 dark:hover:border-sky-500 dark:hover:text-sky-300",children:x.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",strokeWidth:"1.6",className:"h-4 w-4",children:x.jsx("path",{d:"m8 5 5 5-5 5",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),x.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[x.jsxs("figure",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4 text-center shadow-inner dark:border-slate-700 dark:bg-slate-800",children:[x.jsx("figcaption",{className:"mb-3 text-sm font-semibold text-slate-600 dark:text-slate-300",children:N.downloadFinal}),f.balanced?x.jsx("img",{src:f.balanced.url,alt:N.finalAlt,className:"mx-auto aspect-[35/45] w-full max-w-xs rounded-lg border border-slate-200 object-cover shadow-sm dark:border-slate-700"}):x.jsx("div",{className:"flex h-48 items-center justify-center rounded-lg border border-dashed border-slate-300 text-sm text-slate-500 dark:border-slate-700 dark:text-slate-400",children:N.loadingPlaceholder}),x.jsx("button",{type:"button",onClick:()=>u(f.balanced),disabled:!f.balanced,className:"mt-4 inline-flex items-center justify-center gap-2 rounded-md bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-sky-700 focus:outline-none focus:ring-4 focus:ring-sky-200 disabled:cursor-not-allowed disabled:bg-slate-300 dark:bg-sky-500 dark:hover:bg-sky-400 dark:focus:ring-sky-900",children:N.downloadFinal})]}),x.jsxs("figure",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-4 text-center shadow-inner dark:border-slate-700 dark:bg-slate-800",children:[x.jsx("figcaption",{className:"mb-3 text-sm font-semibold text-slate-600 dark:text-slate-300",children:N.overlayHeading}),x.jsx(Gt,{image:f.balanced,markers:f.markers,spans:f.spans,messages:N}),x.jsx("button",{type:"button",onClick:()=>u(f.annotated),disabled:!f.annotated,className:"mt-4 inline-flex items-center justify-center gap-2 rounded-md bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-slate-700 focus:outline-none focus:ring-4 focus:ring-slate-400 disabled:cursor-not-allowed disabled:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 dark:focus:ring-slate-900",children:N.downloadAnnotated})]})]}),x.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-5 dark:border-slate-700 dark:bg-slate-800",children:[x.jsx("h3",{className:"text-base font-semibold text-slate-700 dark:text-slate-200",children:N.metricsHeading}),f.metrics.length>0?x.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:f.metrics.map(i=>x.jsxs("span",{className:fe("inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold",_[i.tone]),children:[x.jsx("span",{className:"h-2 w-2 rounded-full bg-current","aria-hidden":"true"}),i.label,x.jsx("span",{className:"font-normal",children:i.value})]},`${f.id}-${i.label}-${i.value}`))}):x.jsx("p",{className:"mt-3 text-sm text-slate-500 dark:text-slate-300",children:N.metadataMissing})]}),x.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[x.jsx("button",{type:"button",onClick:h,disabled:!g,className:"inline-flex items-center justify-center gap-2 rounded-md bg-emerald-600 px-5 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-700 focus:outline-none focus:ring-4 focus:ring-emerald-200 disabled:cursor-not-allowed disabled:bg-slate-300 dark:bg-emerald-500 dark:hover:bg-emerald-400 dark:focus:ring-emerald-900",children:N.downloadZip}),!g&&x.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:N.downloadDisabled})]})]})]})}function qt({messages:w,language:N}){return x.jsx("footer",{className:"border-t border-slate-200 bg-white/70 px-4 py-6 text-sm text-slate-500 dark:border-slate-800 dark:bg-slate-950/90 dark:text-slate-400",children:x.jsxs("div",{className:"mx-auto flex w-full max-w-5xl flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[x.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[x.jsx("a",{href:"/privacy",className:"hover:text-slate-700 focus:outline-none focus:ring-2 focus:ring-sky-400 dark:hover:text-slate-200","aria-label":w.privacyLinkAria,children:w.footerPrivacy}),x.jsx("a",{href:"/legal",className:"hover:text-slate-700 focus:outline-none focus:ring-2 focus:ring-sky-400 dark:hover:text-slate-200",children:w.footerLegal}),x.jsxs("span",{children:[w.footerLanguage,": ",Qe.find(o=>o.code===N)?.nativeName]})]}),x.jsx("p",{className:"text-xs",children:w.footerCopyright})]})})}const Yt={en:{appTitle:"Digital Photo Assistant",appSubtitle:"Upload a photo and receive compliant ID-ready crops in minutes.",languageLabel:"Language",uploadHeading:"Upload your photo",dragDrop:"Drag & drop your image",dragDropHint:"JPG, PNG or HEIC up to 12 MB",dragActive:"Release to upload",or:"or",chooseFile:"Choose file",useCamera:"Use camera",cameraNotSupported:"Camera capture may not be supported on this device.",privacyNote:"Images processed transiently and deletable at any time.",defaultsHint:"Defaults follow ICAO recommendations.",optionsHeading:"Options",targetHeightLabel:"Target height",targetHeightSuffix:"mm",minHeightLabel:"Minimum height",minWidthLabel:"Minimum width",pixelsSuffix:"px",saveDebugLabel:"Save debug bundle on server",saveDebugDescription:"Keeps intermediate stages to help support debug issues.",guidelinesHeading:"Checklist before you submit",validationGuidelines:"Confirm each item before you continue.",guidelines:["Neutral, evenly lit background","Face centered, eyes level with camera","No harsh shadows or strong reflections","Remove accessories covering the face"],submitButton:"Process photo",submitDisabled:"Select a valid photo to enable processing.",retryButton:"Try again",uploadAnother:"Upload another photo",uploadingSubtitle:"We lock the form while the image is processed.",statusLabels:{idle:"Waiting for photo",validating:"Validating photo",ready:"Ready to submit",processing:"Processing",success:"Done",error:"Needs attention"},phaseTrackerHeading:"Processing timeline",phaseLabels:{queued:"Queued",processing:"Processing",balancing:"Balancing light",detecting:"Detecting face",cropping:"Cropping",annotating:"Annotating",done:"Done"},progressLabel:"Processing progress",ariaProcessingStatus:"Processing status",ariaResultsRegion:"Processing results",ariaUploadZone:"Photo upload zone",resultsHeading:"Review and downloads",resultsDescriptionSingle:"Preview each output and download what you need.",resultsDescriptionMulti:"Multiple faces detected. Review every face before downloading.",metricsHeading:"Key measurements",metadataMissing:"No measurement data supplied.",downloadZip:"Download ZIP",downloadFinal:"Download final JPG",downloadAnnotated:"Download annotated JPG",tipsHeading:"Photo tips and examples",tipsLink:"View tips",errorNoFace:"No face detected. Please retake the photo with better lighting at eye level.",errorNetwork:"The server did not respond. Check your connection and try again.",errorValidation:"The selected file is not a supported image type or exceeds 12 MB.",errorGeneral:"We could not process this photo. Please try again.",errorFileRequired:"Please select a photo before submitting.",toastSuccess:"Processing complete. Review the results below.",toastError:"Processing failed. Check the guidelines and try again.",toastClose:"Close notification",fileNameLabel:"Selected file",removeFile:"Remove file",measurementLabels:{crownToChin:"Crown to chin",foreheadToChin:"Forehead to chin",hairToChin:"Hair to chin",pixelsPerMm:"Pixels per mm"},measurementUnitMm:"mm",measurementUnitPxPerMm:"px/mm",measurementUnitPx:"px",measurementFallback:"Measurement",markerLabels:{crown:"Crown",forehead:"Forehead",chin:"Chin"},faceLabel:"Face",facePosition:"Face {current} of {total}",faceSelectorPrev:"Previous face",faceSelectorNext:"Next face",emptyStateTitle:"Your photo assistant",emptyStateDescription:"Upload a portrait with a neutral background to begin.",downloadDisabled:"Downloads are available after processing.",loadingPlaceholder:"Preparing previews...",settingsHeading:"Advanced settings",helpHeading:"Help and guidelines",footerPrivacy:"Privacy",footerLegal:"Legal",footerLanguage:"Language",footerCopyright:"Digital Photo AI",annotatedAlt:"Annotated portrait with measurement guides",finalAlt:"Balanced final portrait crop",previewAlt:"Preview of the selected photo",languageSwitchAria:"Change language",contrastToggleLabel:"High contrast",contrastToggleOn:"On",contrastToggleOff:"Off",processingTimeHint:"Processing normally completes in a few seconds.",phaseStatusPrefix:"Current step",privacyLinkAria:"Read privacy policy",helpLinkHint:"Open help in a new tab",ariaAdvancedToggle:"Toggle advanced options",advancedHeading:"Advanced options",advancedSummary:"Fine-tune the framing heuristics for special requirements.",targetRatioLabel:"Target width/height ratio",topMarginLabel:"Top margin ratio",bottomUpperLabel:"Lower face ratio",maxCrownToChinLabel:"Max crown to chin",minCrownToChinLabel:"Min crown to chin",targetCrownToChinLabel:"Target crown to chin",maxExtraPaddingLabel:"Max extra padding",ratioSuffix:"ratio",overlayHeading:"Interactive measurement preview",overlayLegendHeading:"Legend"},it:{appTitle:"Assistente foto digitale",appSubtitle:"Carica una foto e ottieni ritagli per documenti in pochi minuti.",languageLabel:"Lingua",uploadHeading:"Carica la tua foto",dragDrop:"Trascina e rilascia l'immagine",dragDropHint:"JPG, PNG o HEIC fino a 12 MB",dragActive:"Rilascia per caricare",or:"oppure",chooseFile:"Scegli file",useCamera:"Usa fotocamera",cameraNotSupported:"La cattura da fotocamera potrebbe non essere supportata su questo dispositivo.",privacyNote:"Le immagini vengono elaborate solo temporaneamente e puoi richiederne l'eliminazione.",defaultsHint:"I valori predefiniti seguono le raccomandazioni ICAO.",optionsHeading:"Opzioni",targetHeightLabel:"Altezza finale",targetHeightSuffix:"mm",minHeightLabel:"Altezza minima",minWidthLabel:"Larghezza minima",pixelsSuffix:"px",saveDebugLabel:"Salva pacchetto di debug sul server",saveDebugDescription:"Conserva le fasi intermedie per facilitare il supporto.",guidelinesHeading:"Lista di controllo prima dell'invio",validationGuidelines:"Conferma ogni voce prima di continuare.",guidelines:["Sfondo neutro e illuminato in modo uniforme","Volto centrato, occhi alla stessa altezza della fotocamera","Nessuna ombra forte o riflessi intensi","Rimuovi accessori che coprono il viso"],submitButton:"Elabora foto",submitDisabled:"Seleziona una foto valida per avviare l'elaborazione.",retryButton:"Riprova",uploadAnother:"Carica un'altra foto",uploadingSubtitle:"Il modulo rimane bloccato mentre l'immagine viene elaborata.",statusLabels:{idle:"In attesa della foto",validating:"Validazione della foto",ready:"Pronto per l'invio",processing:"Elaborazione",success:"Completato",error:"Richiede attenzione"},phaseTrackerHeading:"Cronologia dell'elaborazione",phaseLabels:{queued:"In coda",processing:"Elaborazione",balancing:"Bilanciamento luce",detecting:"Rilevamento volto",cropping:"Ritaglio",annotating:"Annotazione",done:"Fine"},progressLabel:"Avanzamento dell'elaborazione",ariaProcessingStatus:"Stato di elaborazione",ariaResultsRegion:"Risultati di elaborazione",ariaUploadZone:"Area di caricamento foto",resultsHeading:"Revisiona e scarica",resultsDescriptionSingle:"Controlla ogni risultato e scarica cio che ti serve.",resultsDescriptionMulti:"Rilevati piu volti. Controlla ogni volto prima del download.",metricsHeading:"Misure principali",metadataMissing:"Dati di misura non presenti.",downloadZip:"Scarica ZIP",downloadFinal:"Scarica JPG finale",downloadAnnotated:"Scarica JPG annotato",tipsHeading:"Suggerimenti e esempi",tipsLink:"Vedi suggerimenti",errorNoFace:"Nessun volto rilevato. Ripeti la foto con migliore illuminazione e sguardo frontale.",errorNetwork:"Il server non risponde. Controlla la connessione e riprova.",errorValidation:"Il file selezionato non e supportato o supera 12 MB.",errorGeneral:"Impossibile elaborare la foto. Riprova.",errorFileRequired:"Seleziona una foto prima di inviare.",toastSuccess:"Elaborazione completata. Controlla i risultati sotto.",toastError:"Elaborazione fallita. Rivedi la lista di controllo e riprova.",toastClose:"Chiudi notifica",fileNameLabel:"File selezionato",removeFile:"Rimuovi file",measurementLabels:{crownToChin:"Cima testa - mento",foreheadToChin:"Fronte - mento",hairToChin:"Capelli - mento",pixelsPerMm:"Pixel per mm"},measurementUnitMm:"mm",measurementUnitPxPerMm:"px/mm",measurementUnitPx:"px",measurementFallback:"Misura",markerLabels:{crown:"SommitÃ ",forehead:"Fronte",chin:"Mento"},faceLabel:"Volto",facePosition:"Volto {current} di {total}",faceSelectorPrev:"Volto precedente",faceSelectorNext:"Volto successivo",emptyStateTitle:"Il tuo assistente foto",emptyStateDescription:"Carica un ritratto con sfondo neutro per iniziare.",downloadDisabled:"I download saranno disponibili dopo l'elaborazione.",loadingPlaceholder:"Preparazione delle anteprime...",settingsHeading:"Impostazioni avanzate",helpHeading:"Aiuto e linee guida",footerPrivacy:"Privacy",footerLegal:"Note legali",footerLanguage:"Lingua",footerCopyright:"Digital Photo AI",annotatedAlt:"Ritratto annotato con riferimenti di misura",finalAlt:"Ritaglio finale bilanciato",previewAlt:"Anteprima della foto selezionata",languageSwitchAria:"Cambia lingua",contrastToggleLabel:"Alto contrasto",contrastToggleOn:"Attivo",contrastToggleOff:"Disattivo",processingTimeHint:"L'elaborazione richiede in genere pochi secondi.",phaseStatusPrefix:"Fase corrente",privacyLinkAria:"Leggi l'informativa sulla privacy",helpLinkHint:"Apri l'aiuto in una nuova scheda",ariaAdvancedToggle:"Mostra o nascondi le opzioni avanzate",advancedHeading:"Opzioni avanzate",advancedSummary:"Affina le regole di inquadratura per requisiti speciali.",targetRatioLabel:"Rapporto larghezza/altezza",topMarginLabel:"Margine superiore",bottomUpperLabel:"Rapporto parte inferiore",maxCrownToChinLabel:"Distanza massima testa-mento",minCrownToChinLabel:"Distanza minima testa-mento",targetCrownToChinLabel:"Distanza ideale testa-mento",maxExtraPaddingLabel:"Padding extra massimo",ratioSuffix:"rapporto",overlayHeading:"Anteprima interattiva delle misure",overlayLegendHeading:"Legenda"},es:{appTitle:"Asistente de fotos digital",appSubtitle:"Carga una foto y recibe recortes aptos para documentos en minutos.",languageLabel:"Idioma",uploadHeading:"Sube tu foto",dragDrop:"Arrastra y suelta tu imagen",dragDropHint:"JPG, PNG o HEIC hasta 12 MB",dragActive:"Suelta para cargar",or:"o",chooseFile:"Elegir archivo",useCamera:"Usar camara",cameraNotSupported:"La captura con camara puede no estar disponible en este dispositivo.",privacyNote:"Las imagenes se procesan solo de forma temporal y puedes solicitar su eliminacion.",defaultsHint:"Los valores predeterminados siguen las recomendaciones de la OACI.",optionsHeading:"Opciones",targetHeightLabel:"Altura objetivo",targetHeightSuffix:"mm",minHeightLabel:"Altura minima",minWidthLabel:"Ancho minimo",pixelsSuffix:"px",saveDebugLabel:"Guardar paquete de depuracion en el servidor",saveDebugDescription:"Conserva las etapas intermedias para ayudar al soporte.",guidelinesHeading:"Lista de comprobacion antes de enviar",validationGuidelines:"Confirma cada elemento antes de continuar.",guidelines:["Fondo neutro con iluminacion uniforme","Rostro centrado y ojos a la altura de la camara","Sin sombras fuertes ni reflejos intensos","Retira accesorios que cubran el rostro"],submitButton:"Procesar foto",submitDisabled:"Selecciona una foto valida para habilitar el procesamiento.",retryButton:"Intentar de nuevo",uploadAnother:"Subir otra foto",uploadingSubtitle:"Bloqueamos el formulario mientras se procesa la imagen.",statusLabels:{idle:"Esperando foto",validating:"Validando foto",ready:"Lista para enviar",processing:"Procesando",success:"Completado",error:"Requiere atencion"},phaseTrackerHeading:"Linea de tiempo del proceso",phaseLabels:{queued:"En cola",processing:"Procesando",balancing:"Balanceando luz",detecting:"Detectando rostro",cropping:"Recortando",annotating:"Anotando",done:"Listo"},progressLabel:"Progreso del proceso",ariaProcessingStatus:"Estado de procesamiento",ariaResultsRegion:"Resultados del procesamiento",ariaUploadZone:"Zona de subida de fotos",resultsHeading:"Revisar y descargar",resultsDescriptionSingle:"Previsualiza cada resultado y descarga lo necesario.",resultsDescriptionMulti:"Se detectaron varias caras. Revisa cada cara antes de descargar.",metricsHeading:"Medidas clave",metadataMissing:"No se recibieron datos de medidas.",downloadZip:"Descargar ZIP",downloadFinal:"Descargar JPG final",downloadAnnotated:"Descargar JPG anotado",tipsHeading:"Consejos y ejemplos",tipsLink:"Ver consejos",errorNoFace:"No se detecto ninguna cara. Repite la foto con mejor iluminacion a la altura de los ojos.",errorNetwork:"El servidor no respondio. Revisa la conexion e intentalo de nuevo.",errorValidation:"El archivo seleccionado no es valido o supera los 12 MB.",errorGeneral:"No pudimos procesar la foto. Intentalo nuevamente.",errorFileRequired:"Selecciona una foto antes de enviar.",toastSuccess:"Procesamiento completado. Revisa los resultados abajo.",toastError:"Fallo el procesamiento. Revisa la lista de comprobacion e intentalo otra vez.",toastClose:"Cerrar notificacion",fileNameLabel:"Archivo seleccionado",removeFile:"Quitar archivo",measurementLabels:{crownToChin:"Coronilla a menton",foreheadToChin:"Frente a menton",hairToChin:"Cabello a menton",pixelsPerMm:"Pixeles por mm"},measurementUnitMm:"mm",measurementUnitPxPerMm:"px/mm",measurementUnitPx:"px",measurementFallback:"Medida",markerLabels:{crown:"Coronilla",forehead:"Frente",chin:"Barbilla"},faceLabel:"Cara",facePosition:"Cara {current} de {total}",faceSelectorPrev:"Cara anterior",faceSelectorNext:"Cara siguiente",emptyStateTitle:"Tu asistente de fotos",emptyStateDescription:"Sube un retrato con fondo neutro para comenzar.",downloadDisabled:"Las descargas estaran disponibles despues del procesamiento.",loadingPlaceholder:"Preparando vistas previas...",settingsHeading:"Configuraciones avanzadas",helpHeading:"Ayuda y guias",footerPrivacy:"Privacidad",footerLegal:"Aviso legal",footerLanguage:"Idioma",footerCopyright:"Digital Photo AI",annotatedAlt:"Retrato anotado con guias de medida",finalAlt:"Retrato final equilibrado",previewAlt:"Vista previa de la foto seleccionada",languageSwitchAria:"Cambiar idioma",contrastToggleLabel:"Alto contraste",contrastToggleOn:"Activado",contrastToggleOff:"Desactivado",processingTimeHint:"El proceso suele tardar solo unos segundos.",phaseStatusPrefix:"Paso actual",privacyLinkAria:"Leer politica de privacidad",helpLinkHint:"Abrir ayuda en una nueva pestana",ariaAdvancedToggle:"Mostrar u ocultar opciones avanzadas",advancedHeading:"Opciones avanzadas",advancedSummary:"Ajusta las heuristicas de encuadre para requisitos especiales.",targetRatioLabel:"Relacion ancho/alto",topMarginLabel:"Margen superior",bottomUpperLabel:"Relacion zona inferior",maxCrownToChinLabel:"Maximo coronilla-menton",minCrownToChinLabel:"Minimo coronilla-menton",targetCrownToChinLabel:"Objetivo coronilla-menton",maxExtraPaddingLabel:"Padding extra maximo",ratioSuffix:"relacion",overlayHeading:"Vista interactiva de medidas",overlayLegendHeading:"Leyenda"}};function Xt({}){return[{title:"Digital Photo Assistant"},{name:"description",content:"Upload a photo to receive balanced ID-friendly crops, annotations, and downloads."}]}const Vt=nt(function(){const[N,o]=Q.useState("en"),y=Q.useMemo(()=>Yt[N],[N]),[f,s]=Q.useState(!1),[a,n]=Q.useState(null),[d,h]=Q.useState(null),[u,g]=Q.useState("idle"),[_,i]=Q.useState(null),[p,t]=Q.useState([]),[l,c]=Q.useState(null),[b,S]=Q.useState(0),[A,j]=Q.useState(0),[O,I]=Q.useState(!1),[U,L]=Q.useState(null),[$,J]=Q.useState({target_height_mm:45,min_height_px:540,min_width_px:420,save_debug:!1,target_w_over_h:7/9,top_margin_ratio:.1,bottom_upper_ratio:.8,max_crown_to_chin_mm:36,min_crown_to_chin_mm:31,target_crown_to_chin_mm:34,max_extra_padding_px:600}),k=Q.useRef(null),F=Q.useRef(null),r=Q.useRef(null),B=Q.useRef(null),te=Q.useRef(u);Q.useEffect(()=>{if(typeof document>"u")return;const P=document.documentElement,E=document.body;P.classList.add("dark"),E.classList.add("dark"),P.dataset.theme="dark",E.dataset.theme="dark"},[]);const H=Q.useCallback(()=>{r.current!==null&&(window.clearInterval(r.current),r.current=null)},[]);Q.useEffect(()=>{if(!a){h(null);return}const P=URL.createObjectURL(a);return h(P),()=>{URL.revokeObjectURL(P)}},[a]),Q.useEffect(()=>()=>{Rt(p)},[p]),Q.useEffect(()=>{if(p.length===0&&b!==0){S(0);return}b>p.length-1&&S(Math.max(p.length-1,0))},[p,b]),Q.useEffect(()=>{if(u!=="processing")return;j(0);const P=window.setInterval(()=>{j(E=>E>=ye.length-2?E:E+1)},1800);return r.current=P,()=>{window.clearInterval(P),r.current=null}},[u]),Q.useEffect(()=>{if(!U)return;const P=window.setTimeout(()=>{L(null)},6e3);return()=>{window.clearTimeout(P)}},[U]),Q.useEffect(()=>{u==="processing"&&te.current!=="processing"&&window.requestAnimationFrame(()=>{B.current?.scrollIntoView({behavior:"smooth",block:"start"})}),te.current=u},[u]);const re=Q.useCallback(()=>{n(null),g("idle"),i(null),t([]),c(null),S(0),j(0),L(null),k.current&&(k.current.value=""),F.current&&(F.current.value="")},[]),W=Q.useCallback(P=>{if(!P)return;if(g("validating"),i(null),!Pt(P).valid){g("error"),n(null),i(y.errorValidation),L({type:"error",message:y.toastError});return}n(P),t([]),c(null),S(0),j(0),g("ready"),L(null),k.current&&(k.current.value=""),F.current&&(F.current.value="")},[y.errorValidation,y.toastError]),ee=P=>{if(P.preventDefault(),u==="processing"){P.dataTransfer.dropEffect="none";return}P.dataTransfer.dropEffect="copy",I(!0)},R=()=>{I(!1)},z=P=>{if(P.preventDefault(),I(!1),u==="processing")return;const E=P.dataTransfer.files?.[0];W(E??null)},V=Q.useCallback((P,E)=>{J(Z=>({...Z,[P]:Number.isFinite(E)?E:Z[P]}))},[]),Y=Q.useCallback(()=>{J(P=>({...P,save_debug:!P.save_debug}))},[]),K=async P=>{if(P.preventDefault(),!a){i(y.errorFileRequired),g("error"),L({type:"error",message:y.toastError});return}g("processing"),i(null),L(null),t([]),c(null),S(0),j(0);const E=new FormData;E.append("file",a),Lt(E,$),$.save_debug&&E.append("save_debug","true"),console.log({formData:E});try{const Z=_t(),q=await fetch(Z,{method:"POST",body:E});if(!q.ok){const se=await q.text().catch(()=>"");H();let ne=null;if(se)try{ne=Le(JSON.parse(se))}catch{ne=Le(se)}let he=ne??y.errorGeneral;ne||(q.status===422?he=y.errorNoFace:q.status>=500&&(he=y.errorNetwork)),se&&console.error("Processing request returned",q.status,se),g("error"),i(he),L({type:"error",message:y.toastError});return}const G=await q.blob();c(G);const X=await zt(G,y);t(X),S(0),H(),j(ye.length-1),g("success"),L({type:"success",message:y.toastSuccess})}catch(Z){console.error("Processing request failed",Z),H(),g("error"),i(y.errorNetwork),L({type:"error",message:y.toastError})}},oe=()=>{a?(g("ready"),i(null),L(null)):g("idle")},ue=()=>{if(!l)return;const P=new Date().toISOString().replace(/[:T.-]/g,"").slice(0,14);We.saveAs(l,`digital-photo-ai-${P}.zip`)},ae=P=>{P&&We.saveAs(P.blob,P.filename)},ie=Q.useCallback(()=>{k.current?.click()},[]),ce=Q.useCallback(()=>{"mediaDevices"in navigator||L({type:"error",message:y.cameraNotSupported}),F.current?.click()},[y.cameraNotSupported]),le=Q.useMemo(()=>!!a&&u!=="processing"&&u!=="validating",[a,u]),me=Q.useMemo(()=>y.statusLabels[u],[y,u]),pe=Q.useMemo(()=>Math.round(A/Math.max(ye.length-1,1)*100),[A]),e=Q.useMemo(()=>{const P=ye[Math.min(A,ye.length-1)]??"done";return`${y.phaseStatusPrefix}: ${y.phaseLabels[P]}`},[A,y.phaseLabels,y.phaseStatusPrefix]),D=p.length>1,T=p[b]??p[0]??null,v=Q.useCallback(()=>{S(P=>p.length<=1?0:P===0?p.length-1:P-1)},[p.length]),m=Q.useCallback(()=>{S(P=>p.length<=1||P===p.length-1?0:P+1)},[p.length]),C=u==="processing",M=f?"min-h-screen bg-black text-white transition-colors duration-300":"min-h-screen bg-gray-950 text-gray-100 transition-colors duration-300";return x.jsxs("div",{className:M,children:[x.jsxs("main",{className:"mx-auto flex w-full max-w-5xl flex-col gap-8 px-4 pb-16 pt-10 sm:pt-12 lg:pt-16",children:[x.jsx(pt,{messages:y,language:N,onLanguageChange:o,highContrast:f,onToggleContrast:()=>s(P=>!P)}),x.jsx(mt,{toast:U,onDismiss:()=>L(null),closeLabel:y.toastClose}),x.jsxs("form",{className:"grid grid-cols-1 gap-6 lg:grid-cols-[2fr,1fr]",onSubmit:K,"aria-busy":u==="processing",children:[x.jsxs("div",{className:"space-y-6",children:[x.jsx("div",{className:fe("overflow-hidden transition-[max-height,opacity] duration-500 ease-out",C?"pointer-events-none max-h-0 opacity-0":"max-h-[1600px] opacity-100"),"aria-hidden":C,children:x.jsx(Tt,{messages:y,status:u,isDragActive:O,file:a,filePreview:d,onDragOver:ee,onDragLeave:R,onDrop:z,onOpenFileDialog:ie,onOpenCameraDialog:ce,onFileInputChange:W,onRemoveFile:re,fileInputRef:k,cameraInputRef:F})}),x.jsx(Ut,{messages:y,formValues:$,onOptionChange:V,onToggleDebug:Y,status:u,canSubmit:le,onRetry:oe})]}),x.jsx("aside",{className:"space-y-6",children:x.jsx(Wt,{messages:y})})]}),x.jsx("div",{ref:B,children:x.jsx($t,{messages:y,statusLabel:me,phaseStatusText:e,progressPercent:pe,phaseIndex:A})}),x.jsx(Kt,{status:u,messages:y,errorMessage:_,multipleFaces:D,currentFace:T,faceResults:p,selectedFaceIndex:b,onSelectPreviousFace:v,onSelectNextFace:m,onDownloadZip:ue,onDownloadAsset:ae,zipBlob:l,badgeStyles:ht})]}),x.jsx(qt,{messages:y,language:N})]})});export{Vt as default,Xt as meta};
